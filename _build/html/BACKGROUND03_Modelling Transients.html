
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; Kinetics and Reaction Engineering</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'BACKGROUND03_Modelling Transients';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/JQB.png" class="logo__image only-light" alt="Kinetics and Reaction Engineering - Home"/>
    <script>document.write(`<img src="_static/JQB.png" class="logo__image only-dark" alt="Kinetics and Reaction Engineering - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="Chapter1.html">Batch Reactor Analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="ANALYSIS01_Batch.html">Batch Reactors 01</a></li>
<li class="toctree-l2"><a class="reference internal" href="ANALYSIS02_Batch.html">Batch Reactors 02</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Chapter2.html">Flow Reactor Analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="ANALYSIS03_Flow.html">Flow Reactors 01</a></li>
<li class="toctree-l2"><a class="reference internal" href="ANALYSIS04_Flow.html">Flow Reactors 02</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/jqbond/NAM29_KineticsWorkshop/main?urlpath=tree/BACKGROUND03_Modelling Transients.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jqbond/NAM29_KineticsWorkshop" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jqbond/NAM29_KineticsWorkshop/issues/new?title=Issue%20on%20page%20%2FBACKGROUND03_Modelling Transients.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/BACKGROUND03_Modelling Transients.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><no title></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="simple visible nav section-nav flex-column">
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">FastGaussQuadrature</span>
<span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span>
<span class="k">using</span><span class="w"> </span><span class="n">DifferentialEquations</span>
<span class="k">using</span><span class="w"> </span><span class="n">NLsolve</span>
<span class="k">using</span><span class="w"> </span><span class="n">Printf</span>
<span class="k">using</span><span class="w"> </span><span class="n">SparseArrays</span>
<span class="c"># using ModelingToolkit</span>
<span class="k">using</span><span class="w"> </span><span class="n">BenchmarkTools</span>
<span class="k">using</span><span class="w"> </span><span class="n">Statistics</span>
<span class="k">using</span><span class="w"> </span><span class="n">CairoMakie</span>
<span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span>
<span class="k">using</span><span class="w"> </span><span class="n">LaTeXStrings</span>
<span class="k">using</span><span class="w"> </span><span class="n">ForwardDiff</span>
<span class="k">using</span><span class="w"> </span><span class="n">Optim</span>
<span class="k">using</span><span class="w"> </span><span class="n">Polynomials</span>
<span class="k">using</span><span class="w"> </span><span class="n">Noise</span>
<span class="k">using</span><span class="w"> </span><span class="n">Random</span>
<span class="k">using</span><span class="w"> </span><span class="n">NumericalIntegration</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#################################################################</span>
<span class="c">#  Set of 4 Figure Themes for Makie/CairoMakie                  #</span>
<span class="c">#################################################################</span>

<span class="c">#################################################################</span>
<span class="c">#  Defaults for linear axes x,y plots                           #</span>
<span class="c">#################################################################</span>

<span class="n">theme_linear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Theme</span><span class="p">(</span><span class="w">    </span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Figure Attributes</span>
<span class="w">    </span><span class="n">backgroundcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">font</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">figure_padding</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Cycling attributes</span>
<span class="w">    </span><span class="n">Scatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">cycle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cycle</span><span class="p">([[</span><span class="ss">:linecolor</span><span class="p">,</span><span class="w"> </span><span class="ss">:markercolor</span><span class="p">,</span><span class="w"> </span><span class="ss">:color</span><span class="p">,</span><span class="w"> </span><span class="ss">:strokecolor</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">:color</span><span class="p">,</span><span class="w"> </span><span class="ss">:marker</span><span class="p">],</span><span class="w"> </span><span class="n">covary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">),</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Axis attributes</span>
<span class="w">    </span><span class="n">Axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#Font types</span>
<span class="w">        </span><span class="n">titlefont</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xlabelfont</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticklabelfont</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">ylabelfont</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticklabelfont</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#Font sizes</span>
<span class="w">        </span><span class="n">titlesize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">xlabelsize</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticklabelsize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span>
<span class="w">        </span><span class="n">ylabelsize</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticklabelsize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#x axis properties</span>
<span class="w">        </span><span class="n">xscale</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">identity</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticksvisible</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xtickalign</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorticks</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">IntervalsBetween</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
<span class="w">        </span><span class="n">xminorticksvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminortickalign</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticksize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">xtickwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorticksize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminortickwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#y axis properties</span>
<span class="w">        </span><span class="n">yscale</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">identity</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticksvisible</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">ytickalign</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorticks</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">IntervalsBetween</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
<span class="w">        </span><span class="n">yminorticksvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminortickalign</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticksize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">ytickwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorticksize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminortickwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#x grid properties</span>
<span class="w">        </span><span class="n">xgridvisible</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridvisible</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridstyle</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="ss">:solid</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridstyle</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="ss">:dot</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridcolor</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray50&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridcolor</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray80&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#y grid properties</span>
<span class="w">        </span><span class="n">ygridvisible</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridvisible</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridstyle</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="ss">:solid</span><span class="p">,</span><span class="w">        </span>
<span class="w">        </span><span class="n">yminorgridstyle</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="ss">:dot</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridcolor</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray50&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridcolor</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray80&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w">    </span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#other axis properties</span>
<span class="w">        </span><span class="n">spinewidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">aspect</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span>
<span class="w">     </span><span class="p">),</span>

<span class="w">    </span><span class="c">#Legend attributes</span>
<span class="w">    </span><span class="n">Legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">titlefont</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">labelfont</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">labelsize</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span>
<span class="w">        </span><span class="n">framecolor</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="ss">:black</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">),</span><span class="w"> </span>
<span class="w">        </span><span class="n">backgroundcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:white</span>
<span class="w">     </span><span class="p">)</span>
<span class="p">)</span>

<span class="c">#################################################################</span>
<span class="c">#  Defaults for log-log axes x,y plots                          #</span>
<span class="c">#################################################################</span>

<span class="n">theme_log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Theme</span><span class="p">(</span><span class="w">    </span>

<span class="w">    </span><span class="c">#Figure Attributes</span>
<span class="w">    </span><span class="n">backgroundcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">font</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">figure_padding</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Cycling attributes</span>
<span class="w">    </span><span class="n">Scatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">cycle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cycle</span><span class="p">([[</span><span class="ss">:linecolor</span><span class="p">,</span><span class="w"> </span><span class="ss">:markercolor</span><span class="p">,</span><span class="w"> </span><span class="ss">:color</span><span class="p">,</span><span class="w"> </span><span class="ss">:strokecolor</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">:color</span><span class="p">,</span><span class="w"> </span><span class="ss">:marker</span><span class="p">],</span><span class="w"> </span><span class="n">covary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">),</span>
<span class="w">    </span><span class="p">),</span>

<span class="w">    </span><span class="c">#Axis attributes</span>
<span class="w">    </span><span class="n">Axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#Font types</span>
<span class="w">        </span><span class="n">titlefont</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xlabelfont</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticklabelfont</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">ylabelfont</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticklabelfont</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#Font sizes</span>
<span class="w">        </span><span class="n">titlesize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">xlabelsize</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticklabelsize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span>
<span class="w">        </span><span class="n">ylabelsize</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticklabelsize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#x axis properties</span>
<span class="w">        </span><span class="n">xscale</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">log10</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticksvisible</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xtickalign</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorticks</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">IntervalsBetween</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
<span class="w">        </span><span class="n">xminorticksvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminortickalign</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticksize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">xtickwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorticksize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminortickwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#y axis properties</span>
<span class="w">        </span><span class="n">yscale</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">log10</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticksvisible</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">ytickalign</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorticks</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">IntervalsBetween</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
<span class="w">        </span><span class="n">yminorticksvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminortickalign</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticksize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">ytickwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorticksize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminortickwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#x grid properties</span>
<span class="w">        </span><span class="n">xgridvisible</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridvisible</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridstyle</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="ss">:solid</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridstyle</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="ss">:dot</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridcolor</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray50&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridcolor</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray80&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#y grid properties</span>
<span class="w">        </span><span class="n">ygridvisible</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridvisible</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridstyle</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="ss">:solid</span><span class="p">,</span><span class="w">        </span>
<span class="w">        </span><span class="n">yminorgridstyle</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="ss">:dot</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridcolor</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray50&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridcolor</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray80&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w">    </span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#other axis properties</span>
<span class="w">        </span><span class="n">spinewidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">aspect</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span>
<span class="w">     </span><span class="p">),</span>

<span class="w">    </span><span class="c">#Legend attributes</span>
<span class="w">    </span><span class="n">Legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">titlefont</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">labelfont</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">labelsize</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span>
<span class="w">        </span><span class="n">framecolor</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="ss">:black</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">),</span><span class="w"> </span>
<span class="w">        </span><span class="n">backgroundcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:white</span>
<span class="w">     </span><span class="p">)</span>
<span class="p">)</span>

<span class="c">#################################################################</span>
<span class="c">#  Defaults for log x/linear y plots                            #</span>
<span class="c">#################################################################</span>

<span class="n">theme_logx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Theme</span><span class="p">(</span><span class="w">    </span>
<span class="w">    </span><span class="c">#Figure Attributes</span>
<span class="w">    </span><span class="n">backgroundcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">font</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">figure_padding</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Cycling attributes</span>
<span class="w">    </span><span class="n">Scatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">cycle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cycle</span><span class="p">([[</span><span class="ss">:linecolor</span><span class="p">,</span><span class="w"> </span><span class="ss">:markercolor</span><span class="p">,</span><span class="w"> </span><span class="ss">:color</span><span class="p">,</span><span class="w"> </span><span class="ss">:strokecolor</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">:color</span><span class="p">,</span><span class="w"> </span><span class="ss">:marker</span><span class="p">],</span><span class="w"> </span><span class="n">covary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">),</span>
<span class="w">    </span><span class="p">),</span>

<span class="w">    </span><span class="c">#Axis attributes</span>
<span class="w">    </span><span class="n">Axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#Font types</span>
<span class="w">        </span><span class="n">titlefont</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xlabelfont</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticklabelfont</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">ylabelfont</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticklabelfont</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#Font sizes</span>
<span class="w">        </span><span class="n">titlesize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">xlabelsize</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticklabelsize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span>
<span class="w">        </span><span class="n">ylabelsize</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticklabelsize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#x axis properties</span>
<span class="w">        </span><span class="n">xscale</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">log10</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticksvisible</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xtickalign</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorticks</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">IntervalsBetween</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
<span class="w">        </span><span class="n">xminorticksvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminortickalign</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticksize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">xtickwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorticksize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminortickwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#y axis properties</span>
<span class="w">        </span><span class="n">yscale</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">identity</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticksvisible</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">ytickalign</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorticks</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">IntervalsBetween</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
<span class="w">        </span><span class="n">yminorticksvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminortickalign</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticksize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">ytickwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorticksize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminortickwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#x grid properties</span>
<span class="w">        </span><span class="n">xgridvisible</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridvisible</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridstyle</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="ss">:solid</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridstyle</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="ss">:dot</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridcolor</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray50&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridcolor</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray80&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#y grid properties</span>
<span class="w">        </span><span class="n">ygridvisible</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridvisible</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridstyle</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="ss">:solid</span><span class="p">,</span><span class="w">        </span>
<span class="w">        </span><span class="n">yminorgridstyle</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="ss">:dot</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridcolor</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray50&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridcolor</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray80&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w">    </span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#other axis properties</span>
<span class="w">        </span><span class="n">spinewidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">aspect</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span>
<span class="w">     </span><span class="p">),</span>

<span class="w">    </span><span class="c">#Legend attributes</span>
<span class="w">    </span><span class="n">Legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">titlefont</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">labelfont</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">labelsize</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span>
<span class="w">        </span><span class="n">framecolor</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="ss">:black</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">),</span><span class="w"> </span>
<span class="w">        </span><span class="n">backgroundcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:white</span>
<span class="w">     </span><span class="p">)</span>
<span class="p">)</span>

<span class="c">#################################################################</span>
<span class="c">#  Defaults for linear x/log y plots                            #</span>
<span class="c">#################################################################</span>

<span class="n">theme_logy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Theme</span><span class="p">(</span><span class="w">    </span>

<span class="w">    </span><span class="c">#Figure Attributes</span>
<span class="w">    </span><span class="n">backgroundcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">font</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">figure_padding</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Cycling attributes</span>
<span class="w">    </span><span class="n">Scatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">cycle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cycle</span><span class="p">([[</span><span class="ss">:linecolor</span><span class="p">,</span><span class="w"> </span><span class="ss">:markercolor</span><span class="p">,</span><span class="w"> </span><span class="ss">:color</span><span class="p">,</span><span class="w"> </span><span class="ss">:strokecolor</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">:color</span><span class="p">,</span><span class="w"> </span><span class="ss">:marker</span><span class="p">],</span><span class="w"> </span><span class="n">covary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">),</span>
<span class="w">    </span><span class="p">),</span>

<span class="w">    </span><span class="c">#Axis attributes</span>
<span class="w">    </span><span class="n">Axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#Font types</span>
<span class="w">        </span><span class="n">titlefont</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xlabelfont</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticklabelfont</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">ylabelfont</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticklabelfont</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#Font sizes</span>
<span class="w">        </span><span class="n">titlesize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">xlabelsize</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticklabelsize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span>
<span class="w">        </span><span class="n">ylabelsize</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticklabelsize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#x axis properties</span>
<span class="w">        </span><span class="n">xscale</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">identity</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticksvisible</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xtickalign</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorticks</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">IntervalsBetween</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
<span class="w">        </span><span class="n">xminorticksvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminortickalign</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">xticksize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">xtickwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorticksize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminortickwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#y axis properties</span>
<span class="w">        </span><span class="n">yscale</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">log10</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticksvisible</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">ytickalign</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorticks</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">IntervalsBetween</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
<span class="w">        </span><span class="n">yminorticksvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminortickalign</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">yticksize</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">ytickwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorticksize</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminortickwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#x grid properties</span>
<span class="w">        </span><span class="n">xgridvisible</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridvisible</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridstyle</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="ss">:solid</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridstyle</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="ss">:dot</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridcolor</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray50&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridcolor</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray80&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">xgridwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">xminorgridwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#y grid properties</span>
<span class="w">        </span><span class="n">ygridvisible</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridvisible</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridstyle</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="ss">:solid</span><span class="p">,</span><span class="w">        </span>
<span class="w">        </span><span class="n">yminorgridstyle</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="ss">:dot</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridcolor</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray50&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridcolor</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gray80&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">ygridwidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span><span class="n">yminorgridwidth</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w">    </span>
<span class="w">        </span>
<span class="w">        </span><span class="c">#other axis properties</span>
<span class="w">        </span><span class="n">spinewidth</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">aspect</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span>
<span class="w">     </span><span class="p">),</span>

<span class="w">    </span><span class="c">#Legend attributes</span>
<span class="w">    </span><span class="n">Legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="n">titlefont</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">labelfont</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latin Modern Roman 17&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">labelsize</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span>
<span class="w">        </span><span class="n">framecolor</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="ss">:black</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">),</span><span class="w"> </span>
<span class="w">        </span><span class="n">backgroundcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:white</span>
<span class="w">     </span><span class="p">)</span>
<span class="p">)</span>
<span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">CairoMakie</span><span class="o">.</span><span class="n">activate!</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;svg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">P</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w">            </span><span class="c">#bar</span>
<span class="n">P0</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w">            </span><span class="c">#bar</span>
<span class="n">MC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="w">           </span><span class="c">#grams of catalyst in reactor</span>
<span class="n">NS0</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="w">           </span><span class="c">#moles of active sites</span>
<span class="n">FAf</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">              </span><span class="c">#mol/s</span>
<span class="n">FBf</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">              </span><span class="c">#mol/s</span>
<span class="n">FCf</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">              </span><span class="c">#mol/s</span>
<span class="n">FIf</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="w">           </span><span class="c">#mol/s</span>
<span class="n">FAf_S</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">FAf</span><span class="o">/</span><span class="n">NS0</span><span class="w">        </span><span class="c">#mol/s/mol active site</span>
<span class="n">FBf_S</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">FBf</span><span class="o">/</span><span class="n">NS0</span><span class="w">        </span><span class="c">#mol/s/mol active site</span>
<span class="n">FCf_S</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">FCf</span><span class="o">/</span><span class="n">NS0</span><span class="w">        </span><span class="c">#mol/s/mol active site</span>
<span class="n">FIf_S</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">FIf</span><span class="o">/</span><span class="n">NS0</span><span class="w">        </span><span class="c">#mol/s/mol active site</span>
<span class="n">R</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mf">8.314</span><span class="w"> </span><span class="c">#J/mol/K</span>
<span class="n">kb</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">1.380649e-23</span><span class="w"> </span><span class="c">#J/K</span>
<span class="n">h</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mf">6.62607015e-34</span><span class="w"> </span><span class="c">#J*s</span>
<span class="n">phi</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span>
<span class="n">VR</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">50000.0</span><span class="w">  </span><span class="c">#L</span>
<span class="n">VF</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">VR</span><span class="o">*</span><span class="n">phi</span><span class="w"> </span><span class="c">#L</span>
<span class="n">VC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">VR</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">phi</span><span class="p">)</span><span class="w"> </span><span class="c">#L</span>
<span class="n">rhoB</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span>
<span class="n">rhoS0</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span>
<span class="n">kd</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-6</span><span class="w"> </span><span class="c">#1/sec</span>

<span class="n">DSACT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w">      </span><span class="c">#J/mol/K</span>
<span class="n">DHACT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="w">      </span><span class="c">#J/mol</span>
<span class="n">DS</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w">      </span><span class="c">#J/mol/K</span>
<span class="n">DH</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">40</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="w"> </span><span class="c">#J/mol</span>
<span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span>
<span class="n">DHrxn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">sigma</span><span class="o">.*</span><span class="n">DH</span><span class="p">)</span><span class="w"> </span><span class="c">#J/mol</span>
<span class="n">DSrxn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">sigma</span><span class="o">.*</span><span class="n">DS</span><span class="p">)</span><span class="w"> </span><span class="c">#J/mol/K</span>

<span class="c">#Temperature dependent quantities, define each as a function of T to be given as parameter</span>
<span class="n">K</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="n">DS</span><span class="o">/</span><span class="n">R</span><span class="p">)</span><span class="o">.*</span><span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="n">DH</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="p">)</span>
<span class="n">kf</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">kb</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="n">DSACT</span><span class="o">/</span><span class="n">R</span><span class="p">)</span><span class="o">.*</span><span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="n">DHACT</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="p">)</span>
<span class="n">kr</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">kf</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">./</span><span class="n">K</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">Qf</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">FAf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FBf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FCf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FIf</span><span class="p">)</span><span class="o">*</span><span class="mf">0.083145</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="n">P</span><span class="w"> </span><span class="c">#L/s</span>
<span class="n">tauF</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">VF</span><span class="o">/</span><span class="n">Qf</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">DGrxn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DHrxn</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="n">DSrxn</span>
<span class="n">Krxn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="n">DGrxn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="p">)</span>
<span class="n">Kck</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">K</span><span class="p">(</span><span class="n">T</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">K</span><span class="p">(</span><span class="n">T</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">K</span><span class="p">(</span><span class="n">T</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">K</span><span class="p">(</span><span class="n">T</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">TC</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Krxn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="n">Kck</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#System of Ordinary Differential Equationsto be solved</span>

<span class="c">#Best practice is usually to write system of ODEs as in-place updating function</span>
<span class="c">#Convention in Julia is in-place updating indicated with an ! after the function name</span>
<span class="c">#Arguments to function should be f(du, u, p, t) </span>
<span class="c">#du is the &quot;left hand side&quot; of the ODEs to be evaluated at current u, p, t values</span>
<span class="c">#u is the set of state (dependent) variables provided as an array argument</span>
<span class="c">#p is a set of parameters passed to the system of equations</span>
<span class="c">#t is the independent variable of integration (e.g., &quot;time&quot;)</span>

<span class="k">function</span><span class="w"> </span><span class="n">tCSTR!</span><span class="p">(</span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#unpack parameters</span>
<span class="w">    </span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Labelling unknowns for readable equations; Fj [=] mol/s/mol site</span>
<span class="w">    </span><span class="n">FA_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="n">FB_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="w">    </span><span class="n">FC_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="w">    </span><span class="n">tA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="w">    </span><span class="n">tB</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="w">    </span><span class="n">tC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Calculate vacancies from site balance</span>
<span class="w">    </span><span class="n">tV</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tC</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Total molar flowrate of gas phase species</span>
<span class="w">    </span><span class="n">FT_S</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">FA_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FB_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FC_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FIf_S</span><span class="w"> </span><span class="c">#mol/s/mol site</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Mole fractions</span>
<span class="w">    </span><span class="n">yA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FA_S</span><span class="o">/</span><span class="n">FT_S</span>
<span class="w">    </span><span class="n">yB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FB_S</span><span class="o">/</span><span class="n">FT_S</span>
<span class="w">    </span><span class="n">yC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FC_S</span><span class="o">/</span><span class="n">FT_S</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Thermodynamic activities</span>
<span class="w">    </span><span class="n">aA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span><span class="n">aB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yB</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span><span class="n">aC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yC</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Calculate rate constants at system temperature</span>
<span class="w">    </span><span class="n">k1f</span><span class="p">,</span><span class="w"> </span><span class="n">k2f</span><span class="p">,</span><span class="w"> </span><span class="n">k3f</span><span class="p">,</span><span class="w"> </span><span class="n">k4f</span><span class="p">,</span><span class="w"> </span><span class="n">k5f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kf</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span><span class="n">k1r</span><span class="p">,</span><span class="w"> </span><span class="n">k2r</span><span class="p">,</span><span class="w"> </span><span class="n">k3r</span><span class="p">,</span><span class="w"> </span><span class="n">k4r</span><span class="p">,</span><span class="w"> </span><span class="n">k5r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kr</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Elementary reaction rates in TOF units</span>
<span class="w">    </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k1f</span><span class="o">*</span><span class="n">aA</span><span class="o">*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k1r</span><span class="o">*</span><span class="n">tA</span>
<span class="w">    </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k2f</span><span class="o">*</span><span class="n">aB</span><span class="o">*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k2r</span><span class="o">*</span><span class="n">tB</span>
<span class="w">    </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k3f</span><span class="o">*</span><span class="n">aC</span><span class="o">*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k3r</span><span class="o">*</span><span class="n">tC</span>
<span class="w">    </span><span class="n">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k4f</span><span class="o">*</span><span class="n">tA</span><span class="o">*</span><span class="n">tB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k4r</span><span class="o">*</span><span class="n">tC</span><span class="o">*</span><span class="n">tV</span>

<span class="w">    </span><span class="c">#Production rates, TOF units [=] moles species/mole site/time</span>
<span class="w">    </span><span class="n">RA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r1</span>
<span class="w">    </span><span class="n">RB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r2</span>
<span class="w">    </span><span class="n">RC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r3</span>
<span class="w">    </span><span class="n">RAs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span><span class="n">RBs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span><span class="n">RCs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Material balances, LHS = ODE </span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="n">tauF</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">FAf_S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FA_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RA</span><span class="p">)</span><span class="w"> </span><span class="c">#[=] moles species/mole site/time/time</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="n">tauF</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">FBf_S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FB_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RB</span><span class="p">)</span><span class="w"> </span><span class="c">#[=] moles species/mole site/time/time</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="n">tauF</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">FCf_S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FC_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RC</span><span class="p">)</span><span class="w"> </span><span class="c">#[=] moles species/mole site/time/time</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RAs</span><span class="w"> </span><span class="c">#[=] moles species/mole site/time</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RBs</span><span class="w"> </span><span class="c">#[=] moles species/mole site/time</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RCs</span><span class="w"> </span><span class="c">#[=] moles species/mole site/time</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tCSTR! (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#Optional, but useful: write setup and solution of ODE system in a function.</span>

<span class="c">#This example uses a couple of Julia-specific tricks:</span>
<span class="c">#I have written a domainfunction; this is used to specify the domain of your state variables in u</span>
<span class="c">#Here, I am encountering a common problem of state variables going negative as the ODE solver integrates</span>
<span class="c">#There is nothing in the ODE system to mathematically prevent state variables from going negative</span>
<span class="c">#However, physically, negative flowrates and coverages are impossible.</span>
<span class="c">#I want to keep all of my state variables positive, so I write a domain function that specifies this:</span>
<span class="c">#domainfunc = (u, p, t) -&gt; any(x -&gt; x &lt; 0, u)</span>
<span class="c">#This uses an anonymous function (lambda function) syntax that evaluates to true if any(u) &lt; 0</span>
<span class="c">#If any value of u becomes negative, the ODE solver rejects the step and takes a smaller one</span>
<span class="c">#It repeats this until the domain constraint is satisified</span>

<span class="k">function</span><span class="w"> </span><span class="n">tCSTRmain</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">par</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Set up ODE solver, solve problem</span>
<span class="w">    </span><span class="c">#Domain function to keep state variables positive; not always necessary, but is in this example.</span>
<span class="w">    </span><span class="n">domainfunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">any</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Initial state</span>
<span class="w">    </span><span class="n">u0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">]</span><span class="w"> </span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Integration span</span>
<span class="w">    </span><span class="n">tspan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1e13</span><span class="p">)</span><span class="w"> </span><span class="c">#adequate time to reach steady state? t --&gt; : </span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#This is a set of times on a log scale; will interpolate ODE solution to these time points for plotting</span>
<span class="w">    </span><span class="n">tvals</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">.^</span><span class="n">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Define the problem using ODEProblem constructor</span>
<span class="w">    </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ODEProblem</span><span class="p">(</span><span class="n">tCSTR!</span><span class="p">,</span><span class="w"> </span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">tspan</span><span class="p">,</span><span class="w"> </span><span class="n">par</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Solve ODE problem using Rosenbrock23; specifify domain funct and saveat keyword arguments</span>
<span class="w">    </span><span class="n">tCSTRsol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="w"> </span><span class="n">Rosenbrock23</span><span class="p">(),</span><span class="w"> </span><span class="n">isoutofdomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">domainfunc</span><span class="p">,</span><span class="w"> </span><span class="n">saveat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tvals</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Benchmarking results</span>
<span class="w">    </span><span class="c">#display(@benchmark solve($prob, Rosenbrock23(), isoutofdomain = $domainfunc, saveat = $tvals))</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#time set for plotting on log x axis</span>
<span class="w">    </span><span class="c">#Julia ODE solution structures have built in interpolation</span>
<span class="w">    </span><span class="c">#Pass a new time set into the solution, and it will return the values of state variables at those times</span>
<span class="w">    </span><span class="c">#Precision only guaranteed if times specified are within limits of integration span</span>
<span class="w">    </span><span class="n">tCSTRout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTRsol</span><span class="p">(</span><span class="n">tvals</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Output information, function of time.</span>
<span class="w">    </span><span class="n">FA_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTRout</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">FB_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTRout</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">FC_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTRout</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">tA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTRout</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">tB</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTRout</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">tC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTRout</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">tV</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tA</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tB</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tC</span>
<span class="w">    </span><span class="n">XA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">FAf_S</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">FA_S</span><span class="p">)</span><span class="o">/</span><span class="n">FAf_S</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Specify returns</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">FA_S</span><span class="p">,</span><span class="w"> </span><span class="n">FB_S</span><span class="p">,</span><span class="w"> </span><span class="n">FC_S</span><span class="p">,</span><span class="w"> </span><span class="n">XA</span><span class="p">,</span><span class="w"> </span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="n">tB</span><span class="p">,</span><span class="w"> </span><span class="n">tC</span><span class="p">,</span><span class="w"> </span><span class="n">tV</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tCSTRmain (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#Specify conditions for the problem</span>
<span class="n">T</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mi">298</span>
<span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">]</span>

<span class="c">#Solve the problem, store the returns.</span>
<span class="n">tCSTR_tvals</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_FA_S</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_FB_S</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_FC_S</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_XA</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_tA</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_tB</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_tC</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_tV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTRmain</span><span class="p">(</span><span class="n">par0</span><span class="p">);</span>

<span class="c">#Plot results of transient CSTR simulation as function of time.</span>
<span class="c"># plt1 = plot(tCSTR_tvals[tCSTR_FA_S .&gt; 0], tCSTR_FA_S[tCSTR_FA_S .&gt; 0], xscale = :log10, yscale = :log10, label = &quot;FA&quot;, legend = :bottomright)</span>
<span class="c"># plt1 = plot!(plt1, tCSTR_tvals[tCSTR_FB_S .&gt; 0], tCSTR_FB_S[tCSTR_FB_S .&gt; 0], label = &quot;FB&quot;)</span>
<span class="c"># plt1 = plot!(plt1, tCSTR_tvals[tCSTR_FC_S .&gt; 0], tCSTR_FC_S[tCSTR_FC_S .&gt; 0], label = &quot;FC&quot;)</span>

<span class="c"># plt2 = plot(tCSTR_tvals[tCSTR_tA .&gt; 0], tCSTR_tA[tCSTR_tA .&gt; 0], xscale = :log10, yscale = :log10, label = &quot;thetaA&quot;, legend = :bottomright)</span>
<span class="c"># plt2 = plot!(plt2, tCSTR_tvals[tCSTR_tB .&gt; 0], tCSTR_tB[tCSTR_tB .&gt; 0], label = &quot;thetaB&quot;)</span>
<span class="c"># plt2 = plot!(plt2, tCSTR_tvals[tCSTR_tC .&gt; 0], tCSTR_tC[tCSTR_tC .&gt; 0], label = &quot;thetaC&quot;)</span>
<span class="c"># plt2 = plot!(plt2, tCSTR_tvals[tCSTR_tV .&gt; 0], tCSTR_tV[tCSTR_tV .&gt; 0], label = &quot;thetaV&quot;)</span>

<span class="c"># @printf(&quot;Steady state flowrates of A, B, and P are %3.2E, %3.2E, %3.2E mol/s/mol active site \n&quot;, tCSTR_FA_S[end], tCSTR_FB_S[end], tCSTR_FC_S[end])</span>
<span class="c"># @printf(&quot;Fractional Conversion of A is %3.2E \n&quot;, tCSTR_XA[end])</span>
<span class="c"># @printf(&quot;Steady State Coverages of A, B, C, and V are %3.2E, %3.2E, %3.2E, %3.2E \n&quot;, tCSTR_tA[end], tCSTR_tB[end], tCSTR_tC[end], tCSTR_tV[end])</span>
<span class="c"># @printf(&quot;The turnover frequency for this reaction is approximately %3.2E mol/s/mol site.&quot;, tCSTR_FC_S[end])</span>
<span class="c"># display(plt1)</span>
<span class="c"># display(plt2)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Packed Bed Reactors</strong></p>
<p><strong>Dynamic Balances on Tubular Reactors (non-differential operation)</strong></p>
<p>Our interest in this topic stems from frequently attempting to study the kinetics of reactions wherein their is substantial deactivation of the catalyst.  In some systems, we have found that it is not possible to operate under strict differential conditions for the duration of the experiment. The case of a packed bed is unique relative to the CSTR because deactivation implies that, potentially, the number of actives sites is changing as a function of time, but in a packed bed, the number of active sites is perhaps the most relevant characteristic size of the system (as opposed to volume or catalyst mass).  One usually develops material balances on packed beds by consideration of a spatial element of fixed size, e.g., a control volume. Allowing that control volume to approach zero is what generates a spatial derivative in the packed bed.  So it is not entirely clear how to treat the spatial dimension in the case of catalyst deactivation. We find the following to be rigorous and relatively straightforward.</p>
<p><strong>Bulk Species</strong></p>
<p>We begin as for a plug flow reactor by writing a balance on a control volume of size <span class="math notranslate nohighlight">\(\Delta V_R\)</span>. We specifically take this quantity to represent the internal volume of the reactor, which we assume as equivalent to the volume of the bed (catalyst + void space).</p>
<div class="math notranslate nohighlight">
\[\frac{dN_j}{dt} = F_j \, \big|_{V_R} - F_j \, \big|_{V_R + \Delta V_R} + {R_j}\Delta V_R\]</div>
<p>We express the total number of moles of species <em>j</em> in the reactor as the product of its bulk concentration and the free space (the volume of the bulk fluid) in the reactor:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_j\Delta V_F}{dt} = F_j \, \big|_{V_R} - F_j \, \big|_{V_R + \Delta V_R} + {R_j} \Delta V_R\]</div>
<p>And we recognize that the free volume can be expressed as the product of the reactor (bed) volume and the void fraction, <span class="math notranslate nohighlight">\(\phi\)</span>:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_j \phi \Delta V_R}{dt} = F_j \, \big|_{V_R} - F_j \, \big|_{V_R + \Delta V_R} + {R_j} \Delta V_R\]</div>
<p>Now recognizing the <span class="math notranslate nohighlight">\(\Delta V_R\)</span> and <span class="math notranslate nohighlight">\(\phi\)</span> are time independent and dividing the equation by the size of the control volume, <span class="math notranslate nohighlight">\(\Delta V_R\)</span>:</p>
<div class="math notranslate nohighlight">
\[\phi\frac{dC_j}{dt} = \frac{F_j \, \big|_{V_R} - F_j \, \big|_{V_R + \Delta V_R}}{\Delta V_R} + {R_j}\]</div>
<p>Finally, taking the limit as <span class="math notranslate nohighlight">\(\Delta V_R \rightarrow 0\)</span>, we arrive at a relatively familiar form of the dynamic balance on a PFR or Packed Bed:</p>
<div class="math notranslate nohighlight">
\[\phi \frac{\partial C_j}{\partial t} = -\frac{\partial F_j}{\partial V_R} + {R_j}\]</div>
<p>Experimentally, the mass of catalyst in the bed is usually a more convenient spatial description of the bed than the volume of the reactor. We facilitate the conversion by recognizing that:</p>
<div class="math notranslate nohighlight">
\[V_R = \frac{W}{\rho_B}\]</div>
<p>Then:</p>
<div class="math notranslate nohighlight">
\[\phi\frac{\partial C_j}{\partial t} = -\frac{\partial F_j}{\partial \frac{W}{\rho_B}} + {R_j}\]</div>
<p>One assumes that the bulk density of the catalyst bed (material + void) is constant across the bed, so this simplifies to:</p>
<div class="math notranslate nohighlight">
\[\phi \frac{\partial C_j}{\partial t} = -\rho_B \frac{\partial F_j}{\partial W} + {R_j}\]</div>
<p>As usual, we prefer to work in turnover frequency units and so express the volume-normalized intensive production rate <span class="math notranslate nohighlight">\(R_j\)</span> accordingly:</p>
<div class="math notranslate nohighlight">
\[R_j = {R_j}^{\prime\prime\prime}\rho_B \rho_S\]</div>
<p>Where <span class="math notranslate nohighlight">\(\rho_B\)</span> is the bed density, which is assumed constant, and <span class="math notranslate nohighlight">\(\rho_S\)</span> is the active site density. In a packed bed, one expects that the active site density may be may be both time <em>and</em> position dependent, i.e., <span class="math notranslate nohighlight">\(\rho_S = f(t, W)\)</span>.</p>
<div class="math notranslate nohighlight">
\[\phi\frac{\partial C_j}{\partial t} = -\rho_B \frac{\partial F_j}{\partial W} + {R_j}^{\prime\prime\prime}\rho_B \rho_S\]</div>
<p>Factoring and rearranging:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial C_j}{\partial t} = -\frac{\rho_B}{\phi} \left(\frac{\partial F_j}{\partial W} - {R_j}^{\prime\prime\prime}\rho_S\right)\]</div>
<p>This expression is relatively rigorous and general in that weve made no dubious assumptions (yet).  To facilitate solution, it is convenient that the PDE be expressed in terms of a single state variable in time and spatial domains. We do so by expressing concentrations in terms of molar flowrates:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \frac{F_j}{Q}}{\partial t} = -\frac{\rho_B}{\phi} \left(\frac{\partial F_j}{\partial W} - {R_j}^{\prime\prime\prime}\rho_S\right)\]</div>
<p>One assumes that in a typical kinetics experiment, where reactants are present in dilute quantities and conversions are typically low, one can assume that the volumetric flowrate is relatively constant with respect to both time and position in the catalyst bed. As such, we set it equal to its feed value, <span class="math notranslate nohighlight">\(Q_f\)</span>, which is time independent and so facilitates development of the following equation:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial F_j}{\partial t} = -\frac{Q_f\rho_B}{\phi} \left(\frac{\partial F_j}{\partial W} - {R_j}^{\prime\prime\prime}\rho_S\right)\]</div>
<p>Recognizing that the density of the bed can be expressed in terms of catalyst mass and bed volume, one finds:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial F_j}{\partial t} = -\frac{Q_fM_C}{\phi V_R} \left(\frac{\partial F_j}{\partial W} - {R_j}^{\prime\prime\prime}\rho_S\right)\]</div>
<p>We again see a grouping of terms that comprise a hydrodynamic space velocity, which is based on the inlet volumetric flowrate and the void volume:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial F_j}{dt} = -\frac{M_C}{\tau_F} \left(\frac{\partial F_j}{\partial W} + {R_j}^{\prime\prime\prime}\rho_S\right)\]</div>
<p>This is only a slightly less general form of the dynamic material balance in that it invokes the assumption of a constant volumetric flowrate. This balance describes the dynamic and spatial variation (as a function of catalyst mass) of extensive molar flowrates in the packed bed.  One would integrate in the time domain from 0 to the maximum time on stream, and in the mass domain from 0 to the total mass of catalyst in the reactor.</p>
<p><strong>Surface Species</strong></p>
<p>We begin with the same general balance on a control volume, but recognize that surface species do not exist in the bulk; as such, there are no flow terms in the material balance.</p>
<div class="math notranslate nohighlight">
\[\frac{dN_{j,*}}{dt} = {R_{j,*}}\Delta V_R\]</div>
<p>We can express the number of surface species as the product of their concentration and size of the control volume, <span class="math notranslate nohighlight">\(\Delta V_R\)</span>:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_{j,*}\Delta V_R}{dt} = {R_{j,*}}\Delta V_R\]</div>
<p>The <span class="math notranslate nohighlight">\(\Delta V_R\)</span> is time invariant, which gives:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_{j,*}}{dt} = {R_{j,*}}\]</div>
<p>We again choose to work with turnover frequency units and express the volume-normalized production rate of <span class="math notranslate nohighlight">\(j_*\)</span> accordingly.</p>
<div class="math notranslate nohighlight">
\[\frac{dC_{j,*}}{dt} = {R_j}^{\prime\prime\prime}\rho_B \rho_S\]</div>
<p>This is perhaps the most general form of the balance on surface species; note that its form is parallel to this one for bulk species:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial C_j}{\partial t} = -\frac{\rho_B}{\phi} \left(\frac{\partial F_j}{\partial W} - {R_j}^{\prime\prime\prime}\rho_S\right)\]</div>
<p>We will use these two equations as the starting point for the analysis of non-differential packed bed reactors operating with and without dynamic phenomena.</p>
<p><strong>Packed Bed Reactors at Steady State (and without deactivation)</strong></p>
<p>One can begin with the general forms developed above:</p>
<div class="amsmath math notranslate nohighlight" id="equation-d52fff62-5bf0-4d2a-bfc3-64a9401893d9">
<span class="eqno">()<a class="headerlink" href="#equation-d52fff62-5bf0-4d2a-bfc3-64a9401893d9" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{\partial C_j}{\partial t} &amp;= -\frac{\rho_B}{\phi} \left(\frac{\partial F_j}{\partial W} - {R_j}^{\prime\prime\prime}\rho_S\right) \\
    \frac{dC_{j,*}}{dt} &amp;= {R_j}^{\prime\prime\prime}\rho_B \rho_S \\
\end{align}\]</div>
<p>At steady state, these balances simplify considerably:</p>
<div class="amsmath math notranslate nohighlight" id="equation-70c00fa5-07d2-4340-97a6-e932b4d00bfa">
<span class="eqno">()<a class="headerlink" href="#equation-70c00fa5-07d2-4340-97a6-e932b4d00bfa" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{dF_j}{dW} &amp;= {R_j}^{\prime\prime\prime}\rho_S \\
    0 &amp;= {R_j}^{\prime\prime\prime} 
\end{align}\]</div>
<p>For this case, we consider an integral reactor without catalyst deactivation; thus, the active site density, <span class="math notranslate nohighlight">\(\rho_S\)</span>, is constant with respect to position in the reactor. The number of active sites in a system can be represented as the product of catalyst mass (<span class="math notranslate nohighlight">\(W\)</span>) and active site density (<span class="math notranslate nohighlight">\(\rho_S\)</span>):</p>
<div class="math notranslate nohighlight">
\[S = W\rho_S\]</div>
<p>Focusing on the balance for bulk species:</p>
<div class="math notranslate nohighlight">
\[\frac{dF_j}{d \frac{S}{\rho_S} } = {R_j}^{\prime\prime\prime}\rho_S\]</div>
<p>Absent deactivation, we assume <span class="math notranslate nohighlight">\(\rho_S\)</span> is constant throughout the bed, so this equation simplifies to:</p>
<div class="math notranslate nohighlight">
\[\frac{dF_j}{dS} = {R_j}^{\prime\prime\prime}\]</div>
<p>Which converts results in a form that is integrated from 0 to the total mass of the catalyst bed, <span class="math notranslate nohighlight">\(M_C\)</span>, to the number of sites, in the catalyst bed <span class="math notranslate nohighlight">\(N_S\)</span>. As discussed in the CSTR examples, it is convenient to express flowrates in site-time-yield units by normalizing them to the quantity of active sites. To do this, we express the cumulative number of active sites at a given position in the bed, <span class="math notranslate nohighlight">\(S\)</span> as a product of the fraction of active sites (<span class="math notranslate nohighlight">\(\Theta^{\prime\prime\prime}\)</span>) and the total number of active sites (<span class="math notranslate nohighlight">\(N_S\)</span>):</p>
<div class="math notranslate nohighlight">
\[S = \Theta^{\prime\prime\prime} N_S\]</div>
<p>This allows one to convert the TOF units balance to the following form:</p>
<div class="math notranslate nohighlight">
\[\frac{dF_j}{d\left(\Theta^{\prime\prime\prime} N_S\right)} = R_j^{\prime\prime\prime}\]</div>
<p>Assuming the total number of active sites is constant, one can re-write this as:</p>
<div class="math notranslate nohighlight">
\[\frac{d{F_j}^{\prime\prime\prime}}{d\Theta^{\prime\prime\prime}} = R_j^{\prime\prime\prime}\]</div>
<p>Where the flowrate is expressed in site time yield units (inverse time), and the balance is always integrated from 0 to 1.</p>
<p>With these simplifications, for a non-differential PBR without deactivation, the following balances are convenient:</p>
<div class="amsmath math notranslate nohighlight" id="equation-ce82a73a-285f-4214-9f05-17d755f280f5">
<span class="eqno">()<a class="headerlink" href="#equation-ce82a73a-285f-4214-9f05-17d755f280f5" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{d{F_j}^{\prime\prime\prime}}{d\Theta^{\prime\prime\prime}} &amp;= R_j^{\prime\prime\prime} \\
    0 &amp;= R_{j,*}^{\prime\prime\prime}
\end{align}\]</div>
<p><strong>Application to the Mechanism of Interest</strong></p>
<p>Considering our base mechanism:</p>
<div class="amsmath math notranslate nohighlight" id="equation-169b8f65-e8a4-43ac-b4a1-9e67056d711c">
<span class="eqno">()<a class="headerlink" href="#equation-169b8f65-e8a4-43ac-b4a1-9e67056d711c" title="Permalink to this equation">#</a></span>\[\begin{align}
    A + * &amp;\rightleftharpoons A_* \\
    B + * &amp;\rightleftharpoons B_* \\
    C + * &amp;\rightleftharpoons C_* \\
    A_* + B_* &amp;\rightleftharpoons C_* + * \\
\end{align}\]</div>
<p>If this reaction occurs in a packed bed, we write a bulk species balance on A, B, and C, and we write surface balances on <span class="math notranslate nohighlight">\(A_*\)</span>, <span class="math notranslate nohighlight">\(B_*\)</span>, <span class="math notranslate nohighlight">\(C_*\)</span>.</p>
<div class="amsmath math notranslate nohighlight" id="equation-60116b68-881b-4010-a5a3-268e6537ac77">
<span class="eqno">()<a class="headerlink" href="#equation-60116b68-881b-4010-a5a3-268e6537ac77" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{d{F_A}^{\prime \prime \prime}}{d\Theta} &amp;= {R_A}^{\prime \prime \prime} \\
    \frac{d{F_B}^{\prime \prime \prime}}{d\Theta} &amp;= {R_B}^{\prime \prime \prime} \\
    \frac{d{F_C}^{\prime \prime \prime}}{d\Theta} &amp;= {R_C}^{\prime \prime \prime} \\
    0 &amp;= {R_{A_*}}^{\prime \prime \prime} \\
    0 &amp;= {R_{B_*}}^{\prime \prime \prime} \\
    0 &amp;= {R_{C_*}}^{\prime \prime \prime} \\
\end{align}\]</div>
<p>We solve for the vacancies using a site balance as usual.</p>
<div class="math notranslate nohighlight">
\[\theta_V = 1 - \theta_A - \theta_B - \theta_C\]</div>
<p>And we note that, in this case, solution of the DAE system is unavoidable unless there is a tractable analytical solution for the 3 steady state balances on surface species.  In general, this will not be true, and it is necessary to numerically solve the DAE system written in terms of 6 state variables (which we do below).</p>
<p>We express net production rates in terms of elementary reaction rates:</p>
<div class="amsmath math notranslate nohighlight" id="equation-164ec60d-a683-4c47-a5da-8ba1d326b39f">
<span class="eqno">()<a class="headerlink" href="#equation-164ec60d-a683-4c47-a5da-8ba1d326b39f" title="Permalink to this equation">#</a></span>\[\begin{align}
    {R_A}^{\prime \prime \prime} &amp;= -{r_1}^{\prime \prime \prime} \\
    {R_B}^{\prime \prime \prime} &amp;= -{r_2}^{\prime \prime \prime} \\
    {R_C}^{\prime \prime \prime} &amp;= -{r_3}^{\prime \prime \prime} \\
    {R_{A_*}}^{\prime \prime \prime} &amp;= {r_1}^{\prime \prime \prime} - {r_4}^{\prime \prime \prime} \\
    {R_{B_*}}^{\prime \prime \prime} &amp;= {r_2}^{\prime \prime \prime} - {r_4}^{\prime \prime \prime} \\
    {R_{C_*}}^{\prime \prime \prime} &amp;= {r_3}^{\prime \prime \prime} + {r_4}^{\prime \prime \prime} \\
\end{align}\]</div>
<p>And we write elementary rate expressions in terms of activities and coverages:</p>
<div class="amsmath math notranslate nohighlight" id="equation-7c1fce80-ec3e-4f82-b73f-86079c888381">
<span class="eqno">()<a class="headerlink" href="#equation-7c1fce80-ec3e-4f82-b73f-86079c888381" title="Permalink to this equation">#</a></span>\[\begin{align}
    {r_1}^{\prime \prime \prime} &amp;= k_1a_A\theta_* - k_{-1}\theta_A \\
    {r_2}^{\prime \prime \prime} &amp;= k_2a_B\theta_* - k_{-2}\theta_B \\
    {r_3}^{\prime \prime \prime} &amp;= k_3a_C\theta_* - k_{-3}\theta_C \\
    {r_4}^{\prime \prime \prime} &amp;= k_4\theta_A\theta_B - k_{-4}\theta_C\theta_* \\
\end{align}\]</div>
<p>The solution to this system is presented below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">sPFR!</span><span class="p">(</span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">   </span>
<span class="w">    </span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">SStA</span><span class="p">,</span><span class="w"> </span><span class="n">SStB</span><span class="p">,</span><span class="w"> </span><span class="n">SStC</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">FA_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="n">FB_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="w">    </span><span class="n">FC_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="w">    </span><span class="n">tA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="w">    </span><span class="n">tB</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="w">    </span><span class="n">tC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="w">    </span><span class="n">tV</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tC</span>
<span class="w">        </span>
<span class="w">    </span><span class="n">FT_S</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">FA_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FB_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FC_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FIf_S</span><span class="w"> </span><span class="c">#mol/s</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">yA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FA_S</span><span class="o">/</span><span class="n">FT_S</span>
<span class="w">    </span><span class="n">yB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FB_S</span><span class="o">/</span><span class="n">FT_S</span>
<span class="w">    </span><span class="n">yC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FC_S</span><span class="o">/</span><span class="n">FT_S</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">aA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span><span class="n">aB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yB</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span><span class="n">aC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yC</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Calculate rate constants at system temperature</span>
<span class="w">    </span><span class="n">k1f</span><span class="p">,</span><span class="w"> </span><span class="n">k2f</span><span class="p">,</span><span class="w"> </span><span class="n">k3f</span><span class="p">,</span><span class="w"> </span><span class="n">k4f</span><span class="p">,</span><span class="w"> </span><span class="n">k5f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kf</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span><span class="n">k1r</span><span class="p">,</span><span class="w"> </span><span class="n">k2r</span><span class="p">,</span><span class="w"> </span><span class="n">k3r</span><span class="p">,</span><span class="w"> </span><span class="n">k4r</span><span class="p">,</span><span class="w"> </span><span class="n">k5r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kr</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Reaction rates in TOF units</span>
<span class="w">    </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k1f</span><span class="o">*</span><span class="n">aA</span><span class="o">*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k1r</span><span class="o">*</span><span class="n">tA</span>
<span class="w">    </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k2f</span><span class="o">*</span><span class="n">aB</span><span class="o">*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k2r</span><span class="o">*</span><span class="n">tB</span>
<span class="w">    </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k3f</span><span class="o">*</span><span class="n">aC</span><span class="o">*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k3r</span><span class="o">*</span><span class="n">tC</span>
<span class="w">    </span><span class="n">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k4f</span><span class="o">*</span><span class="n">tA</span><span class="o">*</span><span class="n">tB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k4r</span><span class="o">*</span><span class="n">tC</span><span class="o">*</span><span class="n">tV</span>

<span class="w">    </span><span class="c">#Production rates in TOF units</span>
<span class="w">    </span><span class="n">RA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r1</span>
<span class="w">    </span><span class="n">RB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r2</span>
<span class="w">    </span><span class="n">RC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r3</span>
<span class="w">    </span><span class="n">RAs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span><span class="n">RBs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span><span class="n">RCs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RA</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RB</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RC</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RAs</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RBs</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RCs</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">sPFRmain</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
<span class="w">    </span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">SStA</span><span class="p">,</span><span class="w"> </span><span class="n">SStB</span><span class="p">,</span><span class="w"> </span><span class="n">SStC</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">par</span>

<span class="w">    </span><span class="c">#Initial state:</span>
<span class="w">    </span><span class="n">u0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">SStA</span><span class="p">,</span><span class="w"> </span><span class="n">SStB</span><span class="p">,</span><span class="w"> </span><span class="n">SStC</span><span class="p">]</span>
<span class="w">    </span><span class="n">tspan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span>

<span class="w">    </span><span class="c">#Construct mass matrix as shown in markdown cells above</span>
<span class="w">    </span><span class="n">elements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span>
<span class="w">    </span><span class="n">M</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">Diagonal</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
<span class="w">    </span><span class="n">f</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">ODEFunction</span><span class="p">(</span><span class="n">sPFR!</span><span class="p">,</span><span class="w"> </span><span class="n">mass_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="c">#Must use ODEFunction constructor to add the mass matrix option</span>
<span class="w">    </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ODEProblem</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">tspan</span><span class="p">,</span><span class="w"> </span><span class="n">par</span><span class="p">)</span><span class="w"> </span><span class="c">#Run ODEProblem constructor on function f created by ODEFunction</span>
<span class="w">    </span><span class="n">sPFRsol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="w"> </span><span class="n">Rodas4P</span><span class="p">())</span>
<span class="w">    </span><span class="c">#display(@benchmark solve($prob, Rodas4P()))</span>
<span class="w">    </span><span class="n">tvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="n">range</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Int</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)))</span>
<span class="w">    </span><span class="c">#tvals = 10 .^range(-8, stop = 0, length = 200)</span>
<span class="w">    </span><span class="n">sPFRsolf</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsol</span><span class="p">(</span><span class="n">tvals</span><span class="p">)</span>
<span class="w">    </span><span class="n">FA_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsolf</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">FB_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsolf</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">FC_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsolf</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">FT_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FA_S</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">FB_S</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">FC_S</span>
<span class="w">    </span><span class="n">XA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">FAf_S</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">FA_S</span><span class="p">)</span><span class="o">/</span><span class="n">FAf_S</span>
<span class="w">    </span><span class="n">tA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsolf</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">tB</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsolf</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">tC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsolf</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">tV</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tA</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tB</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tC</span>
<span class="w">    </span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FC_S</span><span class="o">.*</span><span class="n">FT_S</span><span class="o">./</span><span class="n">FA_S</span><span class="o">./</span><span class="n">FB_S</span>
<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="o">/</span><span class="n">Krxn</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">FA_S</span><span class="p">,</span><span class="w"> </span><span class="n">FB_S</span><span class="p">,</span><span class="w"> </span><span class="n">FC_S</span><span class="p">,</span><span class="w"> </span><span class="n">XA</span><span class="p">,</span><span class="w"> </span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="n">tB</span><span class="p">,</span><span class="w"> </span><span class="n">tC</span><span class="p">,</span><span class="w"> </span><span class="n">tV</span><span class="p">,</span><span class="w"> </span><span class="n">z</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sPFRmain (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mi">298</span>
<span class="n">SStA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.24</span>
<span class="n">SStB</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.62</span>
<span class="n">SStC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.14</span>
<span class="n">nsteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
<span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">SStA</span><span class="p">,</span><span class="w"> </span><span class="n">SStB</span><span class="p">,</span><span class="w"> </span><span class="n">SStC</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">]</span>
<span class="n">sPFR_tvals</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_FA_S</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_FB_S</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_FC_S</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_XA</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_tA</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_tB</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_tC</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_tV</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRmain</span><span class="p">(</span><span class="n">par0</span><span class="p">);</span>

<span class="c"># plt1 = plot(sPFR_tvals[sPFR_FA_S .&gt; 0], sPFR_FA_S[sPFR_FA_S .&gt; 0], xscale = :identity, yscale = :log10, label = &quot;FA&quot;, legend = :bottomright)</span>
<span class="c"># plt1 = plot!(plt1, sPFR_tvals[sPFR_FB_S .&gt; 0], sPFR_FB_S[sPFR_FB_S .&gt; 0], label = &quot;FB&quot;)</span>
<span class="c"># plt1 = plot!(plt1, sPFR_tvals[sPFR_FC_S .&gt; 0], sPFR_FC_S[sPFR_FC_S .&gt; 0], label = &quot;FC&quot;)</span>

<span class="c"># plt2 = plot(sPFR_tvals[sPFR_tA .&gt; 0], sPFR_tA[sPFR_tA .&gt; 0], xscale = :identity, yscale = :log10, label = &quot;thetaA&quot;, legend = :bottomright)</span>
<span class="c"># plt2 = plot!(plt2, sPFR_tvals[sPFR_tB .&gt; 0], sPFR_tB[sPFR_tB .&gt; 0], label = &quot;thetaB&quot;)</span>
<span class="c"># plt2 = plot!(plt2, sPFR_tvals[sPFR_tC .&gt; 0], sPFR_tC[sPFR_tC .&gt; 0], label = &quot;thetaC&quot;)</span>
<span class="c"># plt2 = plot!(plt2, sPFR_tvals[sPFR_tV .&gt; 0], sPFR_tV[sPFR_tV .&gt; 0], label = &quot;thetaV&quot;)</span>

<span class="c"># plt3 = plot(sPFR_tvals[sPFR_XA .&gt; 0], sPFR_XA[sPFR_XA .&gt; 0], xscale = :identity, yscale = :log10, label = &quot;XA&quot;, legend = :bottomright)</span>

<span class="c"># plt4 = plot(sPFR_tvals[sPFR_z .&gt; 0], sPFR_z[sPFR_z .&gt; 0], xscale = :identity, yscale = :log10, label = &quot;Z&quot;, legend = :bottomright)</span>

<span class="c"># @printf(&quot;Steady state flowrates of A, B, and C are %3.2E, %3.2E, %3.2E mol/s/mol active site \n&quot;, sPFR_FA_S[end], sPFR_FB_S[end], sPFR_FC_S[end])</span>
<span class="c"># @printf(&quot;Fractional Conversion of A is %3.2E \n&quot;, sPFR_XA[end])</span>
<span class="c"># @printf(&quot;Steady State Coverages of A, B, C, I, and V are %3.2E, %3.2E, %3.2E, %3.2E&quot;, sPFR_tA[end], sPFR_tB[end], sPFR_tC[end], sPFR_tV[end])</span>

<span class="c"># display(plt1)</span>
<span class="c"># display(plt2)</span>
<span class="c"># display(plt3)</span>
<span class="c"># display(plt4)</span>
</pre></div>
</div>
</div>
</div>
<p>Alternatively, if one is able to identify a rate controlling step and develop a closed form solution for the overall reaction rate, then it is only necessary to write balances on bulk species, avoiding the problem of solving algebraic equations to determine surface coverages.  For example, here, the parameter set selected ensures that the surface reaction (Step 4) is always rate controlling; as such, one can develop the following expression for the overall reaction rate by assuming that steps 1 - 3 are quasi equilibrated:</p>
<div class="math notranslate nohighlight">
\[{r}^{\prime \prime \prime} = \frac{k_4 K_1 K_2 a_A a_B - k_{-4}K_3a _C}{\left(1 + K_1a_A + K_2a_B + K_3a_C\right)^2}\]</div>
<p>With that, the system is simplified considerably:</p>
<p>We only write balances on A, B, and C, which gives an ODE system expressed in terms of 3 state variables (<span class="math notranslate nohighlight">\(F_A\)</span>, <span class="math notranslate nohighlight">\(F_B\)</span>, and <span class="math notranslate nohighlight">\(F_C\)</span>).</p>
<div class="amsmath math notranslate nohighlight" id="equation-9acdd152-83bc-4077-83e6-982364ddffdd">
<span class="eqno">()<a class="headerlink" href="#equation-9acdd152-83bc-4077-83e6-982364ddffdd" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{d{F_A}^{\prime \prime \prime}}{d\Theta} &amp;= {R_A}^{\prime \prime \prime} \\
    \frac{d{F_B}^{\prime \prime \prime}}{d\Theta} &amp;= {R_B}^{\prime \prime \prime} \\
    \frac{d{F_C}^{\prime \prime \prime}}{d\Theta} &amp;= {R_C}^{\prime \prime \prime} \\
\end{align}\]</div>
<p>We express net production rates for bulk species in terms of the overall reaction rate:</p>
<div class="amsmath math notranslate nohighlight" id="equation-168ebfc0-6116-450e-9582-ac4fd7e95e35">
<span class="eqno">()<a class="headerlink" href="#equation-168ebfc0-6116-450e-9582-ac4fd7e95e35" title="Permalink to this equation">#</a></span>\[\begin{align}
    {R_A}^{\prime \prime \prime} &amp;= -{r}^{\prime \prime \prime} \\
    {R_B}^{\prime \prime \prime} &amp;= -{r}^{\prime \prime \prime} \\
    {R_C}^{\prime \prime \prime} &amp;= {r}^{\prime \prime \prime} \\
\end{align}\]</div>
<p>The solution to this system is presented below.</p>
<p><strong>Dynamic Phenomena in a non-differential Packed Bed (without deactivation)</strong></p>
<p>One can begin with the general forms developed above:</p>
<div class="amsmath math notranslate nohighlight" id="equation-64e3eaeb-ac7b-42eb-89fa-bfa8399361de">
<span class="eqno">()<a class="headerlink" href="#equation-64e3eaeb-ac7b-42eb-89fa-bfa8399361de" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{\partial C_j}{\partial t} &amp;= -\frac{\rho_B}{\phi} \left(\frac{\partial F_j}{\partial W} - {R_j}^{\prime\prime\prime}\rho_S\right) \\
    \frac{dC_{j,*}}{dt} &amp;= {R_j}^{\prime\prime\prime}\rho_B \rho_S \\
\end{align}\]</div>
<p>If there is no deactivation, one can assume the density of active sites is constant and arrive at similar forms of the balance equation to those derived for various CSTR and steady state packed bed models.  Specifically, we will express the densities appearing the above balances:</p>
<div class="amsmath math notranslate nohighlight" id="equation-3cd23a5a-810e-45a6-848c-fb2065f97d54">
<span class="eqno">()<a class="headerlink" href="#equation-3cd23a5a-810e-45a6-848c-fb2065f97d54" title="Permalink to this equation">#</a></span>\[\begin{align}
    \rho_b = \frac{M_C}{V_R} \\
    \rho_s = \frac{N_S}{M_C}
\end{align}\]</div>
<p>Starting with the bulk species balance:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial C_j}{\partial t} = -\frac{\rho_B}{\phi} \left(\frac{\partial F_j}{\partial W} - {R_j}^{\prime\prime\prime}\rho_S\right)\]</div>
<p>We convert the differential element on catalyst mass, W, into one on number of active sites, S.</p>
<div class="math notranslate nohighlight">
\[\frac{\partial C_j}{\partial t} = -\frac{M_C}{V_R\phi} \left(\frac{\partial F_j}{\partial \frac{S}{\rho_S}} - {R_j}^{\prime\prime\prime}\rho_S\right)\]</div>
<p>Then</p>
<div class="math notranslate nohighlight">
\[\frac{\partial C_j}{\partial t} = -\frac{M_CN_S}{M_CV_R\phi} \left(\frac{\partial F_j}{\partial S} - {R_j}^{\prime\prime\prime}\right)\]</div>
<p>Simplifying and rearrangning:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{N_S}\frac{\partial C_j}{\partial t} = -\frac{1}{V_R\phi} \left(\frac{\partial F_j}{\partial S} - {R_j}^{\prime\prime\prime}\right)\]</div>
<p>Expressing concentration for the bulk species in terms of flowrates:</p>
<div class="math notranslate nohighlight">
\[\frac{1}{N_S}\frac{\partial \frac{F_j}{Q}}{\partial t} = -\frac{1}{V_R\phi} \left(\frac{\partial F_j}{\partial S} - {R_j}^{\prime\prime\prime}\right)\]</div>
<p>Assuming that this, in this experiment, the density of the bulk fluid is constant so that the volumetric flowrate is fixed at the feed value, <span class="math notranslate nohighlight">\(Q_f\)</span>, and that the number of active sites in the reactor, <span class="math notranslate nohighlight">\(N_S\)</span>, is time-invariant.</p>
<div class="math notranslate nohighlight">
\[\frac{1}{Q_f}\frac{\partial \frac{F_j}{N_S}}{\partial t} = -\frac{1}{V_R\phi} \left(\frac{\partial F_j}{\partial S} - {R_j}^{\prime\prime\prime}\right)\]</div>
<p>And expressing:</p>
<div class="amsmath math notranslate nohighlight" id="equation-589b39fb-bb7f-4288-b26f-b0d2b565e95e">
<span class="eqno">()<a class="headerlink" href="#equation-589b39fb-bb7f-4288-b26f-b0d2b565e95e" title="Permalink to this equation">#</a></span>\[\begin{align}
    F_j = {F_j}^{\prime\prime\prime} N_S \\
    S   = \Theta N_S
\end{align}\]</div>
<div class="math notranslate nohighlight">
\[\frac{1}{Q_f}\frac{\partial \frac{F_j}{N_S}}{\partial t} = -\frac{1}{V_R\phi} \left(\frac{\partial {F_j}^{\prime\prime\prime} N_S}{\partial \Theta N_S} - {R_j}^{\prime\prime\prime}\right)\]</div>
<p>Which ultimately simplifies to an intensive balance on flowrates normalized by the number of active sites, i.e., site-time yield or turnover frequency units and the limits on spatial integration go from 0 to 1:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial {F_j}^{\prime\prime\prime}}{\partial t} = -\frac{1}{\tau_F} \left(\frac{\partial {F_j}^{\prime\prime\prime}}{\partial \Theta} - {R_j}^{\prime\prime\prime}\right)\]</div>
<p>Analogously, the balance on surface species:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial C_{j,*}}{\partial t} = {R_j}^{\prime\prime\prime}\rho_B \rho_S\]</div>
<p>Can be expressed as follows:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \frac{N_{j,*}}{V_R}}{dt} = {R_j}^{\prime\prime\prime}\rho_B \rho_S\]</div>
<p>Since the size of the reactor is time invariant:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial N_{j,*}}{dt} = {R_j}^{\prime\prime\prime}\rho_B \rho_S V_R\]</div>
<p>We recognize the product of densities and volume as the total number of active sites in the catalyst bed, <span class="math notranslate nohighlight">\(N_S\)</span>:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial N_{j,*}}{dt} = {R_j}^{\prime\prime\prime} N_S\]</div>
<p>And since we have assumed a constant number of active sites, this can be redefined with surface coverage as the state variable:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \theta_{j,*}}{dt} = {R_j}^{\prime\prime\prime}\]</div>
<p>So, for a dynamic packed bed reactor in the absence of catalyst deactivation, we have the following balances:</p>
<div class="amsmath math notranslate nohighlight" id="equation-0d7c9a6b-513f-4f95-830a-c212d085451c">
<span class="eqno">()<a class="headerlink" href="#equation-0d7c9a6b-513f-4f95-830a-c212d085451c" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{\partial {F_j}^{\prime\prime\prime}}{\partial t} &amp;= -\frac{1}{\tau_F} \left(\frac{\partial {F_j}^{\prime\prime\prime}}{\partial \Theta} - {R_j}^{\prime\prime\prime}\right) \\
    \frac{\partial \theta_{j,*}}{dt} &amp;= {R_j}^{\prime\prime\prime}
\end{align}\]</div>
<p>Unfortunately, the governing balances in this scenarioa dynamic, non-integral PBRare partial differential equations.  Although there are many good methods for solving such systems, it is generall cumbersome, especially when using reactor models as the core of an objective function in a parameter estimation routine.  Here, we provide a solution for this problem to illustrate the methodology, and to provide a rigorous benchmark for comparison of subsequent tractable (but approximate) solutions to dynamic phenomena in a non-differential packed bed.</p>
<p>The basic approach that we will use is the method of lines, which requires that we discretize one dimension to convert one of the partial differential equations into a set of algebraic equations. We will then use a numerical ODE solver to integrate the remaining differential equation (now and ODE).  Here, we will discretize the spatial domain (the number of active sites) as it is clear that, in the problem formulated above, the spatial domain goes from 0 to 1.  We will use a backward difference formula to discretize the spatial domain, and then we will integrate the time domain with an ODE solver. Note that there other options for how to solve the PDE, and there are even other options for discretization.  A backward difference formula works reasonably well for a PBR, which has a known boundary condition at the reactor entrance (<span class="math notranslate nohighlight">\(\Theta = 0\)</span>) and a discontinuity in the residence time distribution (the RTD is a Heaviside step at t = <span class="math notranslate nohighlight">\(\tau_F\)</span>).  In some cases, a collocation method may be more computationally efficient, but it introduces oscillatory behavior in a packed bed simulation.  We will cover an example of method of lines with collocation for a PBR with axial dispersion later in the tutorial.</p>
<p>We will not present a complete discussion of finite differences, collocation, or method-of-lines here, but the general approach is that we will discretize the reactor spatially into a number of nodes.  We will solve for the time dependent bulk flowrates and surface coverage at each node, which will give us an approximate solution to both the temporal and spatial profile of flowrates and coverages in the reactor.</p>
<p>As a relatively straightforward example, we consider the approximate solution obtained by assuming a rate determining step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">fdmbd</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="w"> </span><span class="n">upper</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">)</span>
<span class="w">    </span><span class="n">dx</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">upper</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lower</span><span class="p">)</span><span class="o">/</span><span class="n">points</span>
<span class="w">    </span><span class="n">xvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="n">range</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">upper</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">points</span><span class="p">))</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">idxI</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">fill</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">points</span><span class="p">))</span>
<span class="w">    </span><span class="n">idxz</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">fill</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">idxn1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fill</span><span class="p">(</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">points</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">base</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">spdiagm</span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">idxz</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">idxn1</span><span class="p">)</span>
<span class="w">    </span><span class="n">Db</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="n">dx</span><span class="o">*</span><span class="n">base</span>
<span class="w">    </span><span class="n">eye</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">diagm</span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">idxI</span><span class="p">)</span><span class="w"> </span>
<span class="w"> </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">xvals</span><span class="p">,</span><span class="w"> </span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="p">,</span><span class="w"> </span><span class="n">eye</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fdmbd (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<p>Notes: The above discretizes the spatial domain of the reactor into 100 steps of equal size.  Solving this problem takes approximately 20 seconds.  The full system includes balances written on 3 species at each of these 100 steps, which gives 300 differential equations.  While a 20 second solution is not time prohibitive for a single simulation, it is considerably longer than the ODE solutions, which generally require only a few miliseconds.  This can begin to present problems when a parameter estimation routine depends on solution of a PDE (method of lines problem) in order to evaluate the objective function at a given parameter set.  We also note that there is about 1% error in this solution along the length of the reactor compared to the numerical solution of the steady state ODE. This arises to do the fact that finite differenes are a rough approximation of the derivative over the spatial step and it will generally require very small steps sizes (~ 1000 steps) to get close to the true steady-state solution.  This is necessarily going to be an accuracy vs. computation time tradeoff.</p>
<p>The above solution took advantage of assuming a rate determining step to avoid solution of differential equations associated with surface coverages.  This is not always possible, and it is sometimes necessary to instead solve the full set of differential equations corresponding to both bulk and surface species.  This is covered below by writing the following material balances as relevant for all bulk and surface species:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b53bdc9c-b398-4517-9826-14774d098de5">
<span class="eqno">()<a class="headerlink" href="#equation-b53bdc9c-b398-4517-9826-14774d098de5" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{\partial {F_j}^{\prime\prime\prime}}{\partial t} &amp;= -\frac{1}{\tau_F} \left(\frac{\partial {F_j}^{\prime\prime\prime}}{\partial \Theta} - {R_j}^{\prime\prime\prime}\right) \\
    \frac{\partial \theta_{j,*}}{dt} &amp;= {R_j}^{\prime\prime\prime}
\end{align}\]</div>
<p>Here our initial condition is that the molar flowrate of each species and the fractional coverage of each species is zero at time = 0.  Our boundary conditions are the same as in a typical packed bed or plug flow reactor: we assume that the flowrates of species immediately downstream of the reactor entrance are identical to those immediately upstream of the reactor entrance, i.e.:</p>
<br> 
<span style="font-size:1.5em;">
$$F_{j,0^-} = F_{j,0^+}$$ 
</span><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">tPFR!</span><span class="p">(</span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>

<span class="w">    </span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span>

<span class="w">    </span><span class="n">FA_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">FB_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">FC_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">tA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">tB</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">tC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">6</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">FT_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FA_S</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">FB_S</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">FC_S</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">FIf_S</span><span class="w"> </span><span class="c">#mol/s</span>
<span class="w">    </span><span class="n">tV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tA</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tB</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tC</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">yA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FA_S</span><span class="o">./</span><span class="n">FT_S</span>
<span class="w">    </span><span class="n">yB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FB_S</span><span class="o">./</span><span class="n">FT_S</span>
<span class="w">    </span><span class="n">yC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FC_S</span><span class="o">./</span><span class="n">FT_S</span>

<span class="w">    </span><span class="n">aA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span><span class="n">aB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yB</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span><span class="n">aC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yC</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Calculate rate constants at system temperature</span>
<span class="w">    </span><span class="n">k1f</span><span class="p">,</span><span class="w"> </span><span class="n">k2f</span><span class="p">,</span><span class="w"> </span><span class="n">k3f</span><span class="p">,</span><span class="w"> </span><span class="n">k4f</span><span class="p">,</span><span class="w"> </span><span class="n">k5f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kf</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span><span class="n">k1r</span><span class="p">,</span><span class="w"> </span><span class="n">k2r</span><span class="p">,</span><span class="w"> </span><span class="n">k3r</span><span class="p">,</span><span class="w"> </span><span class="n">k4r</span><span class="p">,</span><span class="w"> </span><span class="n">k5r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kr</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Reaction rates in TOF units</span>
<span class="w">    </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k1f</span><span class="o">*</span><span class="n">aA</span><span class="o">.*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k1r</span><span class="o">*</span><span class="n">tA</span>
<span class="w">    </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k2f</span><span class="o">*</span><span class="n">aB</span><span class="o">.*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k2r</span><span class="o">*</span><span class="n">tB</span>
<span class="w">    </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k3f</span><span class="o">*</span><span class="n">aC</span><span class="o">.*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k3r</span><span class="o">*</span><span class="n">tC</span>
<span class="w">    </span><span class="n">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k4f</span><span class="o">*</span><span class="n">tA</span><span class="o">.*</span><span class="n">tB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k4r</span><span class="o">*</span><span class="n">tC</span><span class="o">.*</span><span class="n">tV</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Production rates in TOF units</span>
<span class="w">    </span><span class="n">RA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r1</span>
<span class="w">    </span><span class="n">RB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r2</span>
<span class="w">    </span><span class="n">RC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r3</span>
<span class="w">    </span><span class="n">RAs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span><span class="n">RBs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span><span class="n">RCs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Material balances on species</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">nsteps</span><span class="p">]</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">tauF</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Db</span><span class="o">*</span><span class="n">FA_S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RA</span><span class="p">)</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">tauF</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Db</span><span class="o">*</span><span class="n">FB_S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RB</span><span class="p">)</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">tauF</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Db</span><span class="o">*</span><span class="n">FC_S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RC</span><span class="p">)</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w">  </span><span class="n">RAs</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w">  </span><span class="n">RBs</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">6</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w">  </span><span class="n">RCs</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Boundary condition for a PBR at reactor entrance: F_A0- = F_A0+</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">FAf_S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FA_S</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">FBf_S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FB_S</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCf_S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FC_S</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">tPFRmain</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
<span class="w">    </span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">par</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">Mveca</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">Mveca</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">Mvecd</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">Mvec</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">vcat</span><span class="p">(</span><span class="n">Mveca</span><span class="p">,</span><span class="w"> </span><span class="n">Mveca</span><span class="p">,</span><span class="w"> </span><span class="n">Mveca</span><span class="p">,</span><span class="w"> </span><span class="n">Mvecd</span><span class="p">,</span><span class="w"> </span><span class="n">Mvecd</span><span class="p">,</span><span class="w"> </span><span class="n">Mvecd</span><span class="p">)</span>
<span class="w">    </span><span class="n">M</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">diagm</span><span class="p">(</span><span class="n">Mvec</span><span class="p">)</span>
<span class="w">    </span><span class="n">FA0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">FB0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">FC0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">tA0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">tB0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">tC0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">u0</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">vcat</span><span class="p">(</span><span class="n">FA0</span><span class="p">,</span><span class="w"> </span><span class="n">FB0</span><span class="p">,</span><span class="w"> </span><span class="n">FC0</span><span class="p">,</span><span class="w"> </span><span class="n">tA0</span><span class="p">,</span><span class="w"> </span><span class="n">tB0</span><span class="p">,</span><span class="w"> </span><span class="n">tC0</span><span class="p">)</span>
<span class="w">    </span><span class="n">span</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000</span><span class="p">)</span>
<span class="w">    </span><span class="n">domainfunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">any</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">)</span>
<span class="w">    </span><span class="n">odefun</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">ODEFunction</span><span class="p">(</span><span class="n">tPFR!</span><span class="p">,</span><span class="w"> </span><span class="n">mass_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">prob</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">ODEProblem</span><span class="p">(</span><span class="n">odefun</span><span class="p">,</span><span class="w"> </span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">span</span><span class="p">,</span><span class="w"> </span><span class="n">par</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@time</span><span class="w"> </span><span class="n">soltPFR</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="w"> </span><span class="n">Rodas5</span><span class="p">(),</span><span class="w"> </span><span class="n">save_everystep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>
<span class="w">    </span><span class="n">Vfd</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="n">range</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nsteps</span><span class="p">))</span>
<span class="w">    </span><span class="n">FA_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soltPFR</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="mi">1</span><span class="o">:</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">FB_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soltPFR</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">FC_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soltPFR</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">tA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">soltPFR</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">tB</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">soltPFR</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">tC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">soltPFR</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">6</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">XA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">FAf_S</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">FA_S</span><span class="p">)</span><span class="o">/</span><span class="n">FAf_S</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">soltPFR</span><span class="p">,</span><span class="w"> </span><span class="n">Vfd</span><span class="p">,</span><span class="w"> </span><span class="n">FA_S</span><span class="p">,</span><span class="w"> </span><span class="n">FB_S</span><span class="p">,</span><span class="w"> </span><span class="n">FC_S</span><span class="p">,</span><span class="w"> </span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="n">tB</span><span class="p">,</span><span class="w"> </span><span class="n">tC</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tPFRmain (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#limits on spatial domain</span>
<span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="c">#Finite difference parameters</span>
<span class="n">nsteps</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span>
<span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">xvals</span><span class="p">,</span><span class="w"> </span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="p">,</span><span class="w"> </span><span class="n">eye</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fdmbd</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="w"> </span><span class="n">upper</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">)</span>

<span class="n">T</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">298</span>
<span class="n">tPFRpar0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="p">]</span>
<span class="n">soltPFR</span><span class="p">,</span><span class="w"> </span><span class="n">tPFR_Vfd</span><span class="p">,</span><span class="w"> </span><span class="n">tPFR_FA_S</span><span class="p">,</span><span class="w"> </span><span class="n">tPFR_FB_S</span><span class="p">,</span><span class="w"> </span><span class="n">tPFR_FC_S</span><span class="p">,</span><span class="w"> </span><span class="n">tPFR_tA</span><span class="p">,</span><span class="w"> </span><span class="n">tPFR_tB</span><span class="p">,</span><span class="w"> </span><span class="n">tPFR_tC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tPFRmain</span><span class="p">(</span><span class="n">tPFRpar0</span><span class="p">);</span>

<span class="n">tCSTRpar0</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="p">[</span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">]</span>
<span class="n">tCSTR_tvals</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_FA_S</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_FB_S</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_FC_S</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_XA</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_tA</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_tB</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_tC</span><span class="p">,</span><span class="w"> </span><span class="n">tCSTR_tV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTRmain</span><span class="p">(</span><span class="n">par0</span><span class="p">);</span>

<span class="n">SStA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTR_tA</span><span class="p">[</span><span class="k">end</span><span class="p">]</span>
<span class="n">SStB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTR_tB</span><span class="p">[</span><span class="k">end</span><span class="p">]</span>
<span class="n">SStC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tCSTR_tC</span><span class="p">[</span><span class="k">end</span><span class="p">]</span>

<span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">SStA</span><span class="p">,</span><span class="w"> </span><span class="n">SStB</span><span class="p">,</span><span class="w"> </span><span class="n">SStC</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">]</span>
<span class="n">sPFR_tvals</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_FA_S</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_FB_S</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_FC_S</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_XA</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_tA</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_tB</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_tC</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_tV</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRmain</span><span class="p">(</span><span class="n">par0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Yellow"> Warning: </span>Using arrays or dicts to store parameters of different types can hurt performance.
<span class=" -Color -Color-Bold -Color-Bold-Yellow"> </span>Consider using tuples instead.
<span class=" -Color -Color-Bold -Color-Bold-Yellow"> </span>@ SciMLBase C:\Users\jqbon\.julia\packages\SciMLBase\elLNZ\src\performance_warnings.jl:33
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7.060795 seconds (12.84 M allocations: 1.296 GiB, 6.07% gc time, 86.16% compilation time)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">set_theme!</span><span class="p">(</span><span class="n">theme_linear</span><span class="p">)</span>

<span class="n">fig1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Figure</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">600</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">))</span>
<span class="n">ax1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Axis</span><span class="p">(</span><span class="n">fig1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Axis</span><span class="p">(</span><span class="n">fig1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">yaxisposition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:right</span><span class="p">,</span><span class="w"> </span><span class="n">xaxisposition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:top</span><span class="p">)</span>

<span class="n">CairoMakie</span><span class="o">.</span><span class="n">ylims!</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="n">CairoMakie</span><span class="o">.</span><span class="n">xlims!</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="n">CairoMakie</span><span class="o">.</span><span class="n">ylims!</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="n">CairoMakie</span><span class="o">.</span><span class="n">xlims!</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">xlabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">L</span><span class="s">&quot;\Theta&quot;</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">ylabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;STY (1/s)&quot;</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">xticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mf">0.2</span><span class="o">:</span><span class="mi">1</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">xticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mf">0.2</span><span class="o">:</span><span class="mi">1</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">yticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mf">0.5</span><span class="o">:</span><span class="mi">3</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">yticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mf">0.5</span><span class="o">:</span><span class="mi">3</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">xticklabelsvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">yticklabelsvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>

<span class="n">pl1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">CairoMakie</span><span class="o">.</span><span class="n">lines!</span><span class="p">(</span><span class="n">tPFR_Vfd</span><span class="p">,</span><span class="w"> </span><span class="n">tPFR_FC_S</span><span class="o">*</span><span class="mf">1e6</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Transient&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:green</span><span class="p">,</span><span class="w"> </span><span class="n">linestyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:solid</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">pl1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">CairoMakie</span><span class="o">.</span><span class="n">lines!</span><span class="p">(</span><span class="n">sPFR_tvals</span><span class="p">,</span><span class="w"> </span><span class="n">sPFR_FC_S</span><span class="o">*</span><span class="mf">1e6</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Steady State&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:blue</span><span class="p">,</span><span class="w"> </span><span class="n">linestyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:solid</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span>
<span class="c">#pl1  = CairoMakie.lines!(tCSTRd1_tvals[tCSTRd1_FC .&gt; 0]/1e6, tCSTRd1_FC[tCSTRd1_FC .&gt; 0]*1e6, label = L&quot;F_C&quot;, color = :black, linestyle = :solid, linewidth = 1.5)</span>
<span class="c">#pl1  = CairoMakie.lines!(tCSTR_tvals[tCSTR_FC_S .&gt; 0]/1e6, tCSTR_FC_S[tCSTR_FC_S .&gt; 0]*1e6, label = L&quot;F_C&quot;, color = :black, linestyle = :solid, linewidth = 1.5)</span>
<span class="c">#pl1  = CairoMakie.scatter!(tCSTR_tvals/1e6, tCSTR_FC_S*1e6, marker = :circle, markersize = 13, strokewidth = 1.25, strokecolor = :blue, color = :white)</span>
<span class="c">#pl1  = CairoMakie.lines!(log.(CA), f1.(log.(CA)), color = :black, linestyle = :dash, linewidth = 1.5)</span>
<span class="n">axislegend</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:lt</span><span class="p">,</span><span class="w"> </span><span class="n">framevisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span>

<span class="n">fig1</span>
<span class="n">save</span><span class="p">(</span><span class="s">&quot;PBR1.svg&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fig1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CairoMakie.Screen{SVG}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">set_theme!</span><span class="p">(</span><span class="n">theme_linear</span><span class="p">)</span>

<span class="n">fig1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Figure</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">600</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">))</span>
<span class="n">ax1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Axis</span><span class="p">(</span><span class="n">fig1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Axis</span><span class="p">(</span><span class="n">fig1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">yaxisposition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:right</span><span class="p">,</span><span class="w"> </span><span class="n">xaxisposition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:top</span><span class="p">)</span>

<span class="n">CairoMakie</span><span class="o">.</span><span class="n">ylims!</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">CairoMakie</span><span class="o">.</span><span class="n">xlims!</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="n">CairoMakie</span><span class="o">.</span><span class="n">ylims!</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">CairoMakie</span><span class="o">.</span><span class="n">xlims!</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">xticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mf">0.2</span><span class="o">:</span><span class="mi">1</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">yticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mf">0.01</span><span class="o">:</span><span class="mf">0.05</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">xticks</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mf">0.2</span><span class="o">:</span><span class="mi">1</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">yticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mf">0.01</span><span class="o">:</span><span class="mf">0.05</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">xlabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">L</span><span class="s">&quot;\Theta&quot;</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">ylabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Error&quot;</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">xticklabelsvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">yticklabelsvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>

<span class="n">pl1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">CairoMakie</span><span class="o">.</span><span class="n">scatter!</span><span class="p">(</span><span class="n">tPFR_Vfd</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">sPFR_FC_S</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tPFR_FC_S</span><span class="p">)</span><span class="o">./</span><span class="n">sPFR_FC_S</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">markersize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="n">strokewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.25</span><span class="p">,</span><span class="w"> </span><span class="n">strokecolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:blue</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:white</span><span class="p">)</span>
<span class="c">#pl1  = CairoMakie.lines!(sPFR_tvals, sPFR_FC_S*1e6, label = &quot;Steady State&quot;, color = :blue, linestyle = :solid, linewidth = 1.5)</span>
<span class="c">#pl1  = CairoMakie.lines!(tCSTRd1_tvals[tCSTRd1_FC .&gt; 0]/1e6, tCSTRd1_FC[tCSTRd1_FC .&gt; 0]*1e6, label = L&quot;F_C&quot;, color = :black, linestyle = :solid, linewidth = 1.5)</span>
<span class="c">#pl1  = CairoMakie.lines!(tCSTR_tvals[tCSTR_FC_S .&gt; 0]/1e6, tCSTR_FC_S[tCSTR_FC_S .&gt; 0]*1e6, label = L&quot;F_C&quot;, color = :black, linestyle = :solid, linewidth = 1.5)</span>
<span class="c">#pl1  = CairoMakie.scatter!(tCSTR_tvals/1e6, tCSTR_FC_S*1e6, marker = :circle, markersize = 13, strokewidth = 1.25, strokecolor = :blue, color = :white)</span>
<span class="c">#pl1  = CairoMakie.lines!(log.(CA), f1.(log.(CA)), color = :black, linestyle = :dash, linewidth = 1.5)</span>
<span class="c">#axislegend(position = :lt, framevisible = true)</span>

<span class="n">fig1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b8afb5bc5803d317566f5c0709da269cdc93b81528cdefd1d22f7022446c4614.svg" src="_images/b8afb5bc5803d317566f5c0709da269cdc93b81528cdefd1d22f7022446c4614.svg" /></div>
</div>
<p>In this example, since we wrote balances on 6 species, we decided to further comprimise on precision and only discretize the problem into 25 nodes, resulting in 150 ODEs.  In total, this problem requires approximately 2 seconds to solve and has about 4% error in the prediction of the steady state rate at the exit of the packed bed.</p>
<p>With a transient packed bed model and solution established, one could adapt methods for considering catalyst deactivation presented for a transient CSTR, either by allowing the number or density of active sites to vary with time/composition, or by including an elementary step that encodes the kinetics and thermodynamics of inhibitor accumulation on the catalyst surface.</p>
<p>For example, as shown above, one can develop the following balance on bulk species in a packed bed (assuming constant fluid density):</p>
<div class="math notranslate nohighlight">
\[\frac{\partial F_j}{dt} = -\frac{M_C}{\tau_F} \left(\frac{\partial F_j}{\partial W} + {R_j}^{\prime\prime\prime}\rho_S\right)\]</div>
<p>And we can describe surface species with the following balance:</p>
<div class="math notranslate nohighlight">
\[\frac{dC_{j,*}}{dt} = {R_j}^{\prime\prime\prime}\rho_B \rho_S\]</div>
<p>For bulk species, we again have to resolve partial differential equations, and, as we show above, the method of lines is adequate and relatively straightforward for solving transient packed bed models.  It is convenient to establish a spatial domain that varies between 0 and 1; we can do so in the case of a non-constant number of active sites by normalizing flowrates by catalyst mass, and integrating in the spatial domain over the fraction of catalyst mass at a given position in the bed (<span class="math notranslate nohighlight">\(\Theta_M\)</span>):</p>
<div class="math notranslate nohighlight">
\[\frac{\partial {F_j}^\prime}{dt} = -\frac{1}{\tau_F} \left(\frac{\partial {F_j}^\prime}{\partial \Theta_M} + {R_j}^{\prime\prime\prime}\rho_S\right)\]</div>
<p>In parallel, we could model the transient balances on surface species by expressing concentrations as functions of mole number and volume, which gives the following balance:</p>
<div class="math notranslate nohighlight">
\[\frac{{dN_{j,*}}^\prime}{dt} = {R_j}^{\prime\prime\prime} \rho_S\]</div>
<p>Where again the superscript prime indicates normalization per unit mass of catalyst instead of per unit active site.  In this model, one would add a time-domain description of the active site density, which can be accomplished using the activity models described above, for example:</p>
<div class="math notranslate nohighlight">
\[\rho_S = \rho_{S_0} a\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\frac{da}{dt} = -k_da^2\frac{p_A}{p_0}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">tPFRd1!</span><span class="p">(</span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">FAf_M</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_M</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_M</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_M</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">,</span><span class="w"> </span><span class="n">bdm</span><span class="p">,</span><span class="w"> </span><span class="n">kd</span><span class="p">,</span><span class="w"> </span><span class="n">rhoS0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span>

<span class="w">    </span><span class="n">FA_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">FB_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">FC_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">NA_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">NB_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">NC_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">6</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">a</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">7</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">rhoS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhoS0</span><span class="o">*</span><span class="n">a</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">FT_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FA_M</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">FB_M</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">FC_M</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">FIf_M</span><span class="w"> </span><span class="c">#mol/s</span>
<span class="w">    </span><span class="n">tA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA_M</span><span class="o">./</span><span class="n">rhoS</span>
<span class="w">    </span><span class="n">tB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB_M</span><span class="o">./</span><span class="n">rhoS</span>
<span class="w">    </span><span class="n">tC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NC_M</span><span class="o">./</span><span class="n">rhoS</span>
<span class="w">    </span><span class="n">tV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tA</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tB</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tC</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">yA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FA_M</span><span class="o">./</span><span class="n">FT_M</span>
<span class="w">    </span><span class="n">yB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FB_M</span><span class="o">./</span><span class="n">FT_M</span>
<span class="w">    </span><span class="n">yC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FC_M</span><span class="o">./</span><span class="n">FT_M</span>

<span class="w">    </span><span class="n">aA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span><span class="n">aB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yB</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span><span class="n">aC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yC</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Calculate rate constants at system temperature</span>
<span class="w">    </span><span class="n">k1f</span><span class="p">,</span><span class="w"> </span><span class="n">k2f</span><span class="p">,</span><span class="w"> </span><span class="n">k3f</span><span class="p">,</span><span class="w"> </span><span class="n">k4f</span><span class="p">,</span><span class="w"> </span><span class="n">k5f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kf</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span><span class="n">k1r</span><span class="p">,</span><span class="w"> </span><span class="n">k2r</span><span class="p">,</span><span class="w"> </span><span class="n">k3r</span><span class="p">,</span><span class="w"> </span><span class="n">k4r</span><span class="p">,</span><span class="w"> </span><span class="n">k5r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kr</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Reaction rates in TOF units</span>
<span class="w">    </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k1f</span><span class="o">*</span><span class="n">aA</span><span class="o">.*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k1r</span><span class="o">*</span><span class="n">tA</span>
<span class="w">    </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k2f</span><span class="o">*</span><span class="n">aB</span><span class="o">.*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k2r</span><span class="o">*</span><span class="n">tB</span>
<span class="w">    </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k3f</span><span class="o">*</span><span class="n">aC</span><span class="o">.*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k3r</span><span class="o">*</span><span class="n">tC</span>
<span class="w">    </span><span class="n">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k4f</span><span class="o">*</span><span class="n">tA</span><span class="o">.*</span><span class="n">tB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k4r</span><span class="o">*</span><span class="n">tC</span><span class="o">.*</span><span class="n">tV</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Production rates in TOF units</span>
<span class="w">    </span><span class="n">RA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r1</span>
<span class="w">    </span><span class="n">RB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r2</span>
<span class="w">    </span><span class="n">RC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r3</span>
<span class="w">    </span><span class="n">RAs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span><span class="n">RBs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span><span class="n">RCs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Material balances on species</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">nsteps</span><span class="p">]</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">tauF</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Db</span><span class="o">*</span><span class="n">FA_M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RA</span><span class="o">.*</span><span class="n">rhoS</span><span class="p">)</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">tauF</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Db</span><span class="o">*</span><span class="n">FB_M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RB</span><span class="o">.*</span><span class="n">rhoS</span><span class="p">)</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">tauF</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Db</span><span class="o">*</span><span class="n">FC_M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RC</span><span class="o">.*</span><span class="n">rhoS</span><span class="p">)</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w">  </span><span class="n">RAs</span><span class="o">.*</span><span class="n">rhoS</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w">  </span><span class="n">RBs</span><span class="o">.*</span><span class="n">rhoS</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">6</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w">  </span><span class="n">RCs</span><span class="o">.*</span><span class="n">rhoS</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">7</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w">  </span><span class="o">-</span><span class="n">kd</span><span class="o">*</span><span class="n">a</span><span class="o">.^</span><span class="mi">2</span><span class="w"> </span><span class="o">.*</span><span class="n">aA</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Boundary condition for a PBR at reactor entrance: F_A0- = F_A0+</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">FAf_M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FA_M</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">FBf_M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FB_M</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCf_M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FC_M</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">tPFRd1main</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
<span class="w">    </span><span class="n">FAf_M</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_M</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_M</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_M</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="p">,</span><span class="w"> </span><span class="n">kd</span><span class="p">,</span><span class="w"> </span><span class="n">rhoS0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">par</span>

<span class="w">    </span><span class="n">Mveca</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">Mveca</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">Mvecd</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">Mvec</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">vcat</span><span class="p">(</span><span class="n">Mveca</span><span class="p">,</span><span class="w"> </span><span class="n">Mveca</span><span class="p">,</span><span class="w"> </span><span class="n">Mveca</span><span class="p">,</span><span class="w"> </span><span class="n">Mvecd</span><span class="p">,</span><span class="w"> </span><span class="n">Mvecd</span><span class="p">,</span><span class="w"> </span><span class="n">Mvecd</span><span class="p">,</span><span class="w"> </span><span class="n">Mvecd</span><span class="p">)</span>
<span class="w">    </span><span class="n">M</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">diagm</span><span class="p">(</span><span class="n">Mvec</span><span class="p">)</span>
<span class="w">    </span><span class="n">FA0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">FB0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">FC0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">NA0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">NB0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">NC0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">a0</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">nsteps</span><span class="p">,)</span>
<span class="w">    </span><span class="n">u0</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">vcat</span><span class="p">(</span><span class="n">FA0</span><span class="p">,</span><span class="w"> </span><span class="n">FB0</span><span class="p">,</span><span class="w"> </span><span class="n">FC0</span><span class="p">,</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span><span class="n">NC0</span><span class="p">,</span><span class="w"> </span><span class="n">a0</span><span class="p">)</span>
<span class="w">    </span><span class="n">span</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mi">10000000000</span><span class="p">)</span>
<span class="w">    </span><span class="n">domainfunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">any</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">)</span>
<span class="w">    </span><span class="n">odefun</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">ODEFunction</span><span class="p">(</span><span class="n">tPFRd1!</span><span class="p">,</span><span class="w"> </span><span class="n">mass_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">prob</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">ODEProblem</span><span class="p">(</span><span class="n">odefun</span><span class="p">,</span><span class="w"> </span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">span</span><span class="p">,</span><span class="w"> </span><span class="n">par</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@time</span><span class="w"> </span><span class="n">soltPd1</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="w"> </span><span class="n">Rodas5</span><span class="p">())</span>
<span class="w">    </span><span class="n">Vfd</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="n">range</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nsteps</span><span class="p">))</span>
<span class="w">    </span><span class="n">FA_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soltPd1</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="mi">1</span><span class="o">:</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">FB_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soltPd1</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">FC_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soltPd1</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="mi">2</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">NA_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soltPd1</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">NB_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soltPd1</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="mi">4</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">NC_M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soltPd1</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="mi">5</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">6</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">a</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">soltPd1</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="k">end</span><span class="p">][</span><span class="mi">6</span><span class="o">*</span><span class="n">nsteps</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="mi">7</span><span class="o">*</span><span class="n">nsteps</span><span class="p">]</span>
<span class="w">    </span><span class="n">rhoS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhoS0</span><span class="o">*</span><span class="n">a</span>
<span class="w">    </span><span class="n">tA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">NA_M</span><span class="o">./</span><span class="n">rhoS</span>
<span class="w">    </span><span class="n">tB</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">NB_M</span><span class="o">./</span><span class="n">rhoS</span>
<span class="w">    </span><span class="n">tC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">NC_M</span><span class="o">./</span><span class="n">rhoS</span>
<span class="w">    </span><span class="n">XA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">FAf_M</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">FA_M</span><span class="p">)</span><span class="o">/</span><span class="n">FAf_M</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">soltPd1</span><span class="p">,</span><span class="w"> </span><span class="n">Vfd</span><span class="p">,</span><span class="w"> </span><span class="n">FA_M</span><span class="p">,</span><span class="w"> </span><span class="n">FB_M</span><span class="p">,</span><span class="w"> </span><span class="n">FC_M</span><span class="p">,</span><span class="w"> </span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="n">tB</span><span class="p">,</span><span class="w"> </span><span class="n">tC</span><span class="p">,</span><span class="w"> </span><span class="n">a</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tPFRd1main (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#limits on spatial domain</span>
<span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="c">#Finite difference parameters</span>
<span class="n">nsteps</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span>
<span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">xvals</span><span class="p">,</span><span class="w"> </span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="p">,</span><span class="w"> </span><span class="n">eye</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fdmbd</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="w"> </span><span class="n">upper</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">)</span>

<span class="n">T</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">298</span>
<span class="n">par0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">FAf</span><span class="o">/</span><span class="n">MC</span><span class="p">,</span><span class="w"> </span><span class="n">FBf</span><span class="o">/</span><span class="n">MC</span><span class="p">,</span><span class="w"> </span><span class="n">FCf</span><span class="o">/</span><span class="n">MC</span><span class="p">,</span><span class="w"> </span><span class="n">FIf</span><span class="o">/</span><span class="n">MC</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">,</span><span class="w"> </span><span class="n">Db</span><span class="p">,</span><span class="w"> </span><span class="n">kd</span><span class="p">,</span><span class="w"> </span><span class="n">rhoS0</span><span class="p">]</span>
<span class="n">soltPd1</span><span class="p">,</span><span class="w"> </span><span class="n">tPFRd1_Vfd</span><span class="p">,</span><span class="w"> </span><span class="n">tPFRd1_FA_M</span><span class="p">,</span><span class="w"> </span><span class="n">tPFRd1_FB_M</span><span class="p">,</span><span class="w"> </span><span class="n">tPFRd1_FC_M</span><span class="p">,</span><span class="w"> </span><span class="n">tPFRd1_tA</span><span class="p">,</span><span class="w"> </span><span class="n">tPFRd1_tB</span><span class="p">,</span><span class="w"> </span><span class="n">tPFRd1_tC</span><span class="p">,</span><span class="w"> </span><span class="n">tPFRd1_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tPFRd1main</span><span class="p">(</span><span class="n">par0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5.793038 seconds (9.46 M allocations: 1.473 GiB, 20.60% gc time, 62.85% compilation time)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">tvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">.^</span><span class="n">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span>
<span class="n">expdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">soltPd1</span><span class="p">;</span>
<span class="c">#scatter(expdata.t[expdata.t .&gt; 0], expdata[3*nsteps,expdata.t .&gt; 0], xscale = :identity)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">set_theme!</span><span class="p">(</span><span class="n">theme_linear</span><span class="p">)</span>

<span class="n">fig1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Figure</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">600</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">))</span>
<span class="n">ax1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Axis</span><span class="p">(</span><span class="n">fig1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Axis</span><span class="p">(</span><span class="n">fig1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">yaxisposition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:right</span><span class="p">,</span><span class="w"> </span><span class="n">xaxisposition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:top</span><span class="p">)</span>

<span class="n">CairoMakie</span><span class="o">.</span><span class="n">ylims!</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="n">CairoMakie</span><span class="o">.</span><span class="n">xlims!</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1e4</span><span class="p">)</span>
<span class="n">CairoMakie</span><span class="o">.</span><span class="n">ylims!</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="n">CairoMakie</span><span class="o">.</span><span class="n">xlims!</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1e4</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">xticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mi">2000</span><span class="o">:</span><span class="mi">10000</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">yticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mf">0.5</span><span class="o">:</span><span class="mi">3</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">xticks</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mi">2000</span><span class="o">:</span><span class="mi">10000</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">yticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mf">0.5</span><span class="o">:</span><span class="mi">3</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">xlabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time (s)&quot;</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">ylabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;STY (1/s)&quot;</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">xticklabelsvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">yticklabelsvisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>

<span class="n">pl1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">CairoMakie</span><span class="o">.</span><span class="n">scatter!</span><span class="p">(</span><span class="n">expdata</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">expdata</span><span class="o">.</span><span class="n">t</span><span class="w"> </span><span class="o">.&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span><span class="w"> </span><span class="n">expdata</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">nsteps</span><span class="p">,</span><span class="n">expdata</span><span class="o">.</span><span class="n">t</span><span class="w"> </span><span class="o">.&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1e6</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">markersize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">strokewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">strokecolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:green</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="ss">:white</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">))</span>
<span class="c">#pl1  = CairoMakie.lines!(sPFR_tvals, sPFR_FC_S*1e6, label = &quot;Steady State&quot;, color = :blue, linestyle = :solid, linewidth = 1.5)</span>
<span class="c">#pl1  = CairoMakie.lines!(tCSTRd1_tvals[tCSTRd1_FC .&gt; 0]/1e6, tCSTRd1_FC[tCSTRd1_FC .&gt; 0]*1e6, label = L&quot;F_C&quot;, color = :black, linestyle = :solid, linewidth = 1.5)</span>
<span class="c">#pl1  = CairoMakie.lines!(tCSTR_tvals[tCSTR_FC_S .&gt; 0]/1e6, tCSTR_FC_S[tCSTR_FC_S .&gt; 0]*1e6, label = L&quot;F_C&quot;, color = :black, linestyle = :solid, linewidth = 1.5)</span>
<span class="c">#pl1  = CairoMakie.scatter!(tCSTR_tvals/1e6, tCSTR_FC_S*1e6, marker = :circle, markersize = 13, strokewidth = 1.25, strokecolor = :blue, color = :white)</span>
<span class="c">#pl1  = CairoMakie.lines!(log.(CA), f1.(log.(CA)), color = :black, linestyle = :dash, linewidth = 1.5)</span>
<span class="c">#axislegend(position = :lt, framevisible = true)</span>

<span class="n">fig1</span>
<span class="n">save</span><span class="p">(</span><span class="s">&quot;PBR2.svg&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fig1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CairoMakie.Screen{SVG}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">sPFR2!</span><span class="p">(</span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">   </span>
<span class="w">    </span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">SStA</span><span class="p">,</span><span class="w"> </span><span class="n">SStB</span><span class="p">,</span><span class="w"> </span><span class="n">SStC</span><span class="p">,</span><span class="w"> </span><span class="n">THETA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">FA_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="n">FB_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="w">    </span><span class="n">FC_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="w">    </span><span class="n">tA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="w">    </span><span class="n">tB</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="w">    </span><span class="n">tC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="w">    </span><span class="n">tV</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tC</span>
<span class="w">        </span>
<span class="w">    </span><span class="n">FT_S</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">FA_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FB_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FC_S</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FIf_S</span><span class="w"> </span><span class="c">#mol/s</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">yA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FA_S</span><span class="o">/</span><span class="n">FT_S</span>
<span class="w">    </span><span class="n">yB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FB_S</span><span class="o">/</span><span class="n">FT_S</span>
<span class="w">    </span><span class="n">yC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">FC_S</span><span class="o">/</span><span class="n">FT_S</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">aA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span><span class="n">aB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yB</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span><span class="n">aC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">yC</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">P0</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Calculate rate constants at system temperature</span>
<span class="w">    </span><span class="n">k1f</span><span class="p">,</span><span class="w"> </span><span class="n">k2f</span><span class="p">,</span><span class="w"> </span><span class="n">k3f</span><span class="p">,</span><span class="w"> </span><span class="n">k4f</span><span class="p">,</span><span class="w"> </span><span class="n">k5f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kf</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span><span class="n">k1r</span><span class="p">,</span><span class="w"> </span><span class="n">k2r</span><span class="p">,</span><span class="w"> </span><span class="n">k3r</span><span class="p">,</span><span class="w"> </span><span class="n">k4r</span><span class="p">,</span><span class="w"> </span><span class="n">k5r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kr</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#Reaction rates in TOF units</span>
<span class="w">    </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k1f</span><span class="o">*</span><span class="n">aA</span><span class="o">*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k1r</span><span class="o">*</span><span class="n">tA</span>
<span class="w">    </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k2f</span><span class="o">*</span><span class="n">aB</span><span class="o">*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k2r</span><span class="o">*</span><span class="n">tB</span>
<span class="w">    </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k3f</span><span class="o">*</span><span class="n">aC</span><span class="o">*</span><span class="n">tV</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k3r</span><span class="o">*</span><span class="n">tC</span>
<span class="w">    </span><span class="n">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k4f</span><span class="o">*</span><span class="n">tA</span><span class="o">*</span><span class="n">tB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k4r</span><span class="o">*</span><span class="n">tC</span><span class="o">*</span><span class="n">tV</span>

<span class="w">    </span><span class="c">#Production rates in TOF units</span>
<span class="w">    </span><span class="n">RA</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r1</span>
<span class="w">    </span><span class="n">RB</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r2</span>
<span class="w">    </span><span class="n">RC</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r3</span>
<span class="w">    </span><span class="n">RAs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span><span class="n">RBs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span><span class="n">RCs</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">r3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r4</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RA</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RB</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RC</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RAs</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RBs</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">RCs</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">sPFR2main</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
<span class="w">    </span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">SStA</span><span class="p">,</span><span class="w"> </span><span class="n">SStB</span><span class="p">,</span><span class="w"> </span><span class="n">SStC</span><span class="p">,</span><span class="w"> </span><span class="n">THETA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">par</span>

<span class="w">    </span><span class="c">#Initial state:</span>
<span class="w">    </span><span class="n">u0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">SStA</span><span class="p">,</span><span class="w"> </span><span class="n">SStB</span><span class="p">,</span><span class="w"> </span><span class="n">SStC</span><span class="p">]</span><span class="w">   </span>
<span class="w">    </span><span class="n">tspan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">THETA</span><span class="p">)</span>

<span class="w">    </span><span class="c">#Construct mass matrix as shown in markdown cells above</span>
<span class="w">    </span><span class="n">elements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span>
<span class="w">    </span><span class="n">M</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">Diagonal</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
<span class="w">    </span><span class="n">f</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">ODEFunction</span><span class="p">(</span><span class="n">sPFR!</span><span class="p">,</span><span class="w"> </span><span class="n">mass_matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="c">#Must use ODEFunction constructor to add the mass matrix option</span>
<span class="w">    </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ODEProblem</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">tspan</span><span class="p">,</span><span class="w"> </span><span class="n">par</span><span class="p">)</span><span class="w"> </span><span class="c">#Run ODEProblem constructor on function f created by ODEFunction</span>
<span class="w">    </span><span class="n">sPFRsol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="w"> </span><span class="n">Rodas4P</span><span class="p">())</span>
<span class="w">    </span><span class="n">FA_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsol</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">FB_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsol</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">FC_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsol</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">FT_S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FA_S</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">FB_S</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">FC_S</span>
<span class="w">    </span><span class="n">XA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">FAf_S</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">FA_S</span><span class="p">)</span><span class="o">/</span><span class="n">FAf_S</span>
<span class="w">    </span><span class="n">tA</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsol</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">tB</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsol</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">tC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">sPFRsol</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">tV</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tA</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tB</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">tC</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sPFRsol</span><span class="p">,</span><span class="w"> </span><span class="n">FA_S</span><span class="p">,</span><span class="w"> </span><span class="n">FB_S</span><span class="p">,</span><span class="w"> </span><span class="n">FC_S</span><span class="p">,</span><span class="w"> </span><span class="n">XA</span><span class="p">,</span><span class="w"> </span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="n">tB</span><span class="p">,</span><span class="w"> </span><span class="n">tC</span><span class="p">,</span><span class="w"> </span><span class="n">tV</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sPFR2main (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">298</span>
<span class="c"># tCSTRpar0 =  [FAf_S, FBf_S, FCf_S, FIf_S, T, P, P0]</span>
<span class="c"># tCSTR_tvals, tCSTR_FA_S, tCSTR_FB_S, tCSTR_FC_S, tCSTR_XA, tCSTR_tA, tCSTR_tB, tCSTR_tC, tCSTR_tV = tCSTRmain(par0);</span>

<span class="c"># SStA = tCSTR_tA[end]</span>
<span class="c"># SStB = tCSTR_tB[end]</span>
<span class="c"># SStC = tCSTR_tC[end]</span>

<span class="n">timeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">.^</span><span class="n">range</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span>
<span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">./</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">kd</span><span class="o">*</span><span class="n">timeset</span><span class="p">)</span>
<span class="n">FC_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">timeset</span><span class="p">))</span>

<span class="nd">@time</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">THETA</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w">   </span>
<span class="w">    </span><span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">FAf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FBf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FCf_S</span><span class="p">,</span><span class="w"> </span><span class="n">FIf_S</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">SStA</span><span class="p">,</span><span class="w"> </span><span class="n">SStB</span><span class="p">,</span><span class="w"> </span><span class="n">SStC</span><span class="p">,</span><span class="w"> </span><span class="n">THETA</span><span class="p">]</span>
<span class="w">    </span><span class="n">sPFRsol</span><span class="p">,</span><span class="w"> </span><span class="n">FA_S</span><span class="p">,</span><span class="w"> </span><span class="n">FB_S</span><span class="p">,</span><span class="w"> </span><span class="n">FC_S</span><span class="p">,</span><span class="w"> </span><span class="n">XA</span><span class="p">,</span><span class="w"> </span><span class="n">tA</span><span class="p">,</span><span class="w"> </span><span class="n">tB</span><span class="p">,</span><span class="w"> </span><span class="n">tC</span><span class="p">,</span><span class="w"> </span><span class="n">tV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sPFR2main</span><span class="p">(</span><span class="n">par0</span><span class="p">)</span>
<span class="w">    </span><span class="n">FC_out</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FC_S</span><span class="p">[</span><span class="k">end</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">plt1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scatter</span><span class="p">(</span><span class="n">timeset</span><span class="p">,</span><span class="w"> </span><span class="n">FC_out</span><span class="p">,</span><span class="w"> </span><span class="n">xscale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:identity</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">plt1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.148316 seconds (257.08 k allocations: 10.815 MiB, 94.24% compilation time)
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Invalid</span> <span class="n">attribute</span> <span class="n">xscale</span> <span class="k">for</span> <span class="n">plot</span> <span class="nb">type</span> <span class="n">Scatter</span><span class="p">{</span><span class="n">Tuple</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Point</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="n">Float64</span><span class="p">}}}}</span><span class="o">.</span>

<span class="n">The</span> <span class="n">available</span> <span class="n">plot</span> <span class="n">attributes</span> <span class="k">for</span> <span class="n">Scatter</span><span class="p">{</span><span class="n">Tuple</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Point</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="n">Float64</span><span class="p">}}}}</span> <span class="n">are</span><span class="p">:</span>

<span class="n">alpha</span>        <span class="n">depthsorting</span>     <span class="n">inspector_hover</span>  <span class="n">nan_color</span>         <span class="n">transformation</span> 
<span class="n">clip_planes</span>  <span class="n">distancefield</span>    <span class="n">inspector_label</span>  <span class="n">overdraw</span>          <span class="n">transparency</span>   
<span class="n">color</span>        <span class="n">fxaa</span>             <span class="n">lowclip</span>          <span class="n">rotation</span>          <span class="n">uv_offset_width</span>
<span class="n">colormap</span>     <span class="n">glowcolor</span>        <span class="n">marker</span>           <span class="n">space</span>             <span class="n">visible</span>        
<span class="n">colorrange</span>   <span class="n">glowwidth</span>        <span class="n">marker_offset</span>    <span class="n">ssao</span>                             
<span class="n">colorscale</span>   <span class="n">highclip</span>         <span class="n">markersize</span>       <span class="n">strokecolor</span>                      
<span class="n">cycle</span>        <span class="n">inspectable</span>      <span class="n">markerspace</span>      <span class="n">strokewidth</span>                      
<span class="n">depth_shift</span>  <span class="n">inspector_clear</span>  <span class="n">model</span>            <span class="n">transform_marker</span>                 


<span class="n">Generic</span> <span class="n">attributes</span> <span class="n">are</span><span class="p">:</span>

<span class="n">clip_planes</span>  <span class="n">dim_conversions</span>  <span class="n">model</span>      <span class="n">transformation</span>  <span class="n">yautolimits</span>        
<span class="n">cycle</span>        <span class="n">label</span>            <span class="n">rasterize</span>  <span class="n">xautolimits</span>     <span class="n">zautolimits</span>        



<span class="ne">Stacktrace</span>:
 <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">validate_attribute_keys</span><span class="p">(</span><span class="n">plot</span><span class="p">::</span><span class="n">Scatter</span><span class="p">{</span><span class="n">Tuple</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Point</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="n">Float64</span><span class="p">}}}})</span>
   <span class="o">@</span> <span class="n">MakieCore</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">jqbon</span>\<span class="o">.</span><span class="n">julia</span>\<span class="n">packages</span>\<span class="n">MakieCore</span>\<span class="n">hXATT</span>\<span class="n">src</span>\<span class="n">recipes</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">733</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">push</span><span class="o">!(</span>scene::Scene,<span class="w"> </span>plot::Plot<span class="o">)</span>
   <span class="o">@</span> <span class="n">Makie</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">jqbon</span>\<span class="o">.</span><span class="n">julia</span>\<span class="n">packages</span>\<span class="n">Makie</span>\<span class="mi">8</span><span class="n">h0bl</span>\<span class="n">src</span>\<span class="n">scenes</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">459</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">plot</span><span class="err">!</span>
   <span class="o">@</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">jqbon</span>\<span class="o">.</span><span class="n">julia</span>\<span class="n">packages</span>\<span class="n">Makie</span>\<span class="mi">8</span><span class="n">h0bl</span>\<span class="n">src</span>\<span class="n">interfaces</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">399</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">plot</span><span class="o">!(</span>ax::Axis,<span class="w"> </span>plot::Scatter<span class="o">{</span>Tuple<span class="o">{</span>Vector<span class="o">{</span>Point<span class="o">{</span><span class="m">2</span>,<span class="w"> </span>Float64<span class="o">}}}})</span>
   <span class="o">@</span> <span class="n">Makie</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">jqbon</span>\<span class="o">.</span><span class="n">julia</span>\<span class="n">packages</span>\<span class="n">Makie</span>\<span class="mi">8</span><span class="n">h0bl</span>\<span class="n">src</span>\<span class="n">figureplotting</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">412</span>
 <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">plot</span><span class="o">!(</span>fa::Makie.FigureAxis,<span class="w"> </span>plot::Scatter<span class="o">{</span>Tuple<span class="o">{</span>Vector<span class="o">{</span>Point<span class="o">{</span><span class="m">2</span>,<span class="w"> </span>Float64<span class="o">}}}})</span>
   <span class="o">@</span> <span class="n">Makie</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">jqbon</span>\<span class="o">.</span><span class="n">julia</span>\<span class="n">packages</span>\<span class="n">Makie</span>\<span class="mi">8</span><span class="n">h0bl</span>\<span class="n">src</span>\<span class="n">figureplotting</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">407</span>
 <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">_create_plot</span><span class="p">(::</span><span class="n">Function</span><span class="p">,</span> <span class="p">::</span><span class="n">Dict</span><span class="p">{</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">Any</span><span class="p">},</span> <span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="p">::</span><span class="n">Vararg</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">}})</span>
   <span class="o">@</span> <span class="n">Makie</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">jqbon</span>\<span class="o">.</span><span class="n">julia</span>\<span class="n">packages</span>\<span class="n">Makie</span>\<span class="mi">8</span><span class="n">h0bl</span>\<span class="n">src</span>\<span class="n">figureplotting</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">318</span>
 <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="n">scatter</span><span class="p">(::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="p">::</span><span class="n">Vararg</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">}};</span> <span class="n">kw</span><span class="p">::</span><span class="nd">@Kwargs</span><span class="p">{</span><span class="n">xscale</span><span class="p">::</span><span class="n">Symbol</span><span class="p">})</span>
   <span class="o">@</span> <span class="n">MakieCore</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">jqbon</span>\<span class="o">.</span><span class="n">julia</span>\<span class="n">packages</span>\<span class="n">MakieCore</span>\<span class="n">hXATT</span>\<span class="n">src</span>\<span class="n">recipes</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">436</span>
 <span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
   <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span><span class="mi">19</span>
</pre></div>
</div>
</div>
</div>
<p>Compared to the analogous PDE solution where transients are treated explicitly for all species, this solution requires only fractions of a second to consider the performance of the packed bed in each time-state of catalyst deactivation. This is a useful approximation in cases where transients associated with system hydrodynamics and variation in surface coverage are either fast or have died out and the only transient remaining is one associated with catalyst deactivation.</p>
<p><strong>To add</strong></p>
<p>Callback functions for stopping integration at steady state
Cases where deactivation is just approach to true steady state coverage/rate (two surface rxns or desorbing species at two different rates?)
Applications to SSITKA
How to interpret SSITKA when there is reversible reaction/adsorption, i.e., 1/tau ~= TOF (?)
Using AD models to allow a collocation discretization to speed up solutions.
Parameter estimation problems:</p>
<p>SSITKA using tCSTR model for reactor under differential operation
Method of lines for a PBR with hydrodynamics, induction, and deactivation</p>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.11"
        },
        kernelOptions: {
            name: "julia-1.11",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.11'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="simple visible nav section-nav flex-column">
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jesse Q. Bond, Syracuse University
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>