
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Case Study 1: Two catalysts in a Batch Reactor &#8212; Kinetics and Reaction Engineering</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'GENERATION01_Batch';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/JQB.png" class="logo__image only-light" alt="Kinetics and Reaction Engineering - Home"/>
    <script>document.write(`<img src="_static/JQB.png" class="logo__image only-dark" alt="Kinetics and Reaction Engineering - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to the Kinetics workshop!
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="Chapter1.html">Batch Reactor Analysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="ANALYSIS01_Batch.html">Batch Reactors 01</a></li>
<li class="toctree-l2"><a class="reference internal" href="ANALYSIS02_Batch.html">Batch Reactors 02</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Chapter2.html">Lectures</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="ANALYSIS03_Flow.html">Flow Reactors 01</a></li>
<li class="toctree-l2"><a class="reference internal" href="ANALYSIS04_Flow.html">Flow Reactors 02</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/jqbond/CEN587/main?urlpath=tree/GENERATION01_Batch.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jqbond/CEN587" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jqbond/CEN587/issues/new?title=Issue%20on%20page%20%2FGENERATION01_Batch.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/GENERATION01_Batch.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Case Study 1: Two catalysts in a Batch Reactor</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-reaction">The Reaction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-1-catalyst-1-with-no-deactivation">System 1: Catalyst 1 with no deactivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#available-data">Available Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-the-ode-system-that-describes-batch-reactor">Construct the ODE system that describes batch reactor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-a-script-to-solve-the-ode-system-and-process-the-solution">Writing a script to solve the ODE system and process the solution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-the-ode-problem-and-storing-the-output">Solving the ODE problem and storing the output</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-2-catalyst-2-with-deactivation">System 2: Catalyst 2 with deactivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Available Data</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="case-study-1-two-catalysts-in-a-batch-reactor">
<h1>Case Study 1: Two catalysts in a Batch Reactor<a class="headerlink" href="#case-study-1-two-catalysts-in-a-batch-reactor" title="Link to this heading">#</a></h1>
<p>The scripts below were used to generate batch reactor data presented in the manuscript. In addition, scripts are included for regression of kinetic parameters and preparation of figures used in the manuscript</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#Packages used in this Notebook</span>

<span class="k">using</span><span class="w"> </span><span class="n">DifferentialEquations</span>
<span class="k">using</span><span class="w"> </span><span class="n">Printf</span>
<span class="k">using</span><span class="w"> </span><span class="n">BenchmarkTools</span>
<span class="k">using</span><span class="w"> </span><span class="n">CairoMakie</span>
<span class="k">using</span><span class="w"> </span><span class="n">LaTeXStrings</span>
<span class="k">using</span><span class="w"> </span><span class="n">Polynomials</span>
<span class="k">using</span><span class="w"> </span><span class="n">DelimitedFiles</span>
<span class="k">using</span><span class="w"> </span><span class="n">JLD2</span>
<span class="k">using</span><span class="w"> </span><span class="n">Distributions</span>
<span class="k">using</span><span class="w"> </span><span class="n">Random</span>
<span class="k">using</span><span class="w"> </span><span class="n">ComponentArrays</span>
<span class="k">using</span><span class="w"> </span><span class="n">Parameters</span>
</pre></div>
</div>
</div>
</div>
<section id="the-reaction">
<h2>The Reaction<a class="headerlink" href="#the-reaction" title="Link to this heading">#</a></h2>
<p>For this case study, we consider a simple, irreversible reaction performed in a perfectly mixed batch reactor:</p>
<div class="math notranslate nohighlight">
\[A \longrightarrow B\]</div>
<p>This specific reaction has elementary kinetics. Assuming thermodynamic ideality (fugacity coefficients for all species are unity) and that the transition state is an adsorbed species, one can develop the following rate expression in turnover frequency units from transition state theory:</p>
<div class="math notranslate nohighlight">
\[r^{\prime\prime\prime} = ka_A\]</div>
<p>Where <span class="math notranslate nohighlight">\(a_A\)</span> is the thermodynamic activity of species A in the reactor. For a reaction where bulk species are present in a thermodynamically ideal gas phase, we define thermodynamic activity as:</p>
<div class="math notranslate nohighlight">
\[a_j = \frac{y_jP}{P^\circ}\]</div>
<p>Because we consider this reaction in a perfectly mixed batch reactor, we can assume that distributions of species are spatially uniform in the batch reactor (thus rates are spatially uniform in the batch reactor).  This allows us to write the following balance on species <span class="math notranslate nohighlight">\(j\)</span>:</p>
<div class="math notranslate nohighlight">
\[\frac{dN_j}{dt} = \nu_j r'''N_S\]</div>
<p>Where <span class="math notranslate nohighlight">\(N_j\)</span> is the number of moles of species <span class="math notranslate nohighlight">\(j\)</span> in the reactor and <span class="math notranslate nohighlight">\(N_S\)</span> is the number of moles of active sites in the reactor.</p>
</section>
<section id="system-1-catalyst-1-with-no-deactivation">
<h2>System 1: Catalyst 1 with no deactivation<a class="headerlink" href="#system-1-catalyst-1-with-no-deactivation" title="Link to this heading">#</a></h2>
<p>For this case, we will assume that the catalyst is stable such that the number of active sites, <span class="math notranslate nohighlight">\(N_S\)</span> is constant at its initial value, <span class="math notranslate nohighlight">\(N_{S0}\)</span>. That is, the number of active sites is time invariant, giving:</p>
<div class="math notranslate nohighlight">
\[\frac{dN_j}{dt} = \nu_j r'''N_{S0}\]</div>
<p>There are only two quantities that vary in the time domain for this process:  <span class="math notranslate nohighlight">\(N_A\)</span> and <span class="math notranslate nohighlight">\(N_B\)</span>. As such, writing balances on A and B gives a system of ODEs that can be solved to model the molar quantities of A and B as they change with time.</p>
<div class="amsmath math notranslate nohighlight" id="equation-026ba610-b858-457f-bc80-3d9841ea71bf">
<span class="eqno">()<a class="headerlink" href="#equation-026ba610-b858-457f-bc80-3d9841ea71bf" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{dN_A}{dt} &amp;= -r'''N_{S0} \\
    \frac{dN_B}{dt} &amp;= r'''N_{S0}
\end{align}\]</div>
<p>where for Catalyst 1</p>
<div class="math notranslate nohighlight">
\[r^{\prime\prime\prime} = k_1a_A\]</div>
<p>Note that for this simple example, the ODEs are not coupled, so it is not necessary to solve both simultaneously; however, this is not generally true for complex reaction networks, so we present the solution as though the balances on A and B were coupled ODEs. For this case, we have the following parameters available:</p>
<section id="available-data">
<h3>Available Data<a class="headerlink" href="#available-data" title="Link to this heading">#</a></h3>
<div class="amsmath math notranslate nohighlight" id="equation-00ad45c3-c2dd-40eb-b7bb-b8a581943d4e">
<span class="eqno">()<a class="headerlink" href="#equation-00ad45c3-c2dd-40eb-b7bb-b8a581943d4e" title="Permalink to this equation">#</a></span>\[\begin{align}
    T       &amp;= 450.0 \ \mathrm{K} \\
    P       &amp;= 1 \ \mathrm{bar} \\ 
    P^\circ &amp;= 1 \ \mathrm{bar} \\ 
    N_{A0}  &amp;= 10 \ \mathrm{moles \ of \ A}\\
    N_{B0}  &amp;= 0 \ \mathrm{moles \ of \ B} \\
    N_{S0}  &amp;= 1.0 \times 10^{-3} \ \mathrm{moles \ of \ Active \ sites} \\
    A_{1}   &amp;= 1.0 \times 10^{13} \ \mathrm{s^{-1}} \\
    E_{A1}  &amp;= 100 \ \mathrm{kJ \ mol^{-1}}
\end{align}\]</div>
<p>For these problems, we additionally multiply all simulated data by noise selected randomly from a gaussian distribution with a mean of 1 and a standard deviation of 0.01.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#Specify conditions for the problem</span>
<span class="n">T0</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">450</span><span class="w">        </span><span class="c">#K</span>
<span class="n">P</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">          </span><span class="c">#bar</span>
<span class="n">P0</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">          </span><span class="c">#bar</span>
<span class="n">R</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">0.08314</span><span class="w">    </span><span class="c">#L*bar/mol/K</span>
<span class="n">R1</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">8.314</span><span class="w">      </span><span class="c">#J/mol/K </span>
<span class="n">NA0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="w">       </span><span class="c">#moles</span>
<span class="n">NB0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w">        </span><span class="c">#moles</span>
<span class="n">NT0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">NA0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NB0</span><span class="w">  </span><span class="c">#moles</span>
<span class="n">NS0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0e-3</span><span class="w">     </span><span class="c">#moles</span>
<span class="n">V</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">NT0</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">T0</span><span class="o">/</span><span class="n">P</span><span class="w"> </span><span class="c">#L</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>374.13
</pre></div>
</div>
</div>
</div>
</section>
<section id="construct-the-ode-system-that-describes-batch-reactor">
<h3>Construct the ODE system that describes batch reactor<a class="headerlink" href="#construct-the-ode-system-that-describes-batch-reactor" title="Link to this heading">#</a></h3>
<p>The cell below creates a function that captures the behavior of the batch reactor.  Note that Julia allows in-place updating of the ODE function to improve speed. We use this syntax here.  Conventional ODE functions are usually defined in terms of state variables (<span class="math notranslate nohighlight">\(u\)</span>) and independent variables (<span class="math notranslate nohighlight">\(t\)</span>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">odefun</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>Julia additionally includes an argument for passing parameters (<span class="math notranslate nohighlight">\(p\)</span>):</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">odefun</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, Julia allows in place updating (mutating) of the ODE function, which offers improved speed.  The syntax in this case is:</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">odefun!</span><span class="p">(</span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>Where the arguments are <code class="docutils literal notranslate"><span class="pre">du</span></code> is the derivative of state variables; <code class="docutils literal notranslate"><span class="pre">u</span></code> is the value of the state variables; <code class="docutils literal notranslate"><span class="pre">p</span></code> includes any extra parameters; and <code class="docutils literal notranslate"><span class="pre">t</span></code> is the independent variable. The exclamation point in the function definition is not required to use in place updating; however, the syntax convention in Julia is that mutating functions are designated with an exclamation point <code class="docutils literal notranslate"><span class="pre">!</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">odebatch1!</span><span class="p">(</span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">,</span><span class="w"> </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">NA</span><span class="p">,</span><span class="w"> </span><span class="n">NB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="w">       </span><span class="c">#moles</span>
<span class="w">    </span><span class="n">NT</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NB</span><span class="w"> </span><span class="c">#total moles</span>
<span class="w">    </span><span class="n">NS</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">NS0</span><span class="w">     </span><span class="c">#moles of sites</span>
<span class="w">        </span>
<span class="w">    </span><span class="n">yA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="o">/</span><span class="n">NT</span><span class="w">      </span><span class="c">#mole fraction of A</span>
<span class="w">    </span><span class="n">yB</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NB</span><span class="o">/</span><span class="n">NT</span><span class="w">      </span><span class="c">#mole fraction of B</span>
<span class="w">            </span>
<span class="w">    </span><span class="n">pA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="w">       </span><span class="c">#partial pressure of A, bar</span>
<span class="w">    </span><span class="n">pB</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">yB</span><span class="o">*</span><span class="n">P</span><span class="w">       </span><span class="c">#partial pressure of B, bar</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">aA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">pA</span><span class="o">/</span><span class="n">P0</span><span class="w">      </span><span class="c">#thermodynamic activity of A</span>
<span class="w">    </span><span class="n">aB</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">pB</span><span class="o">/</span><span class="n">P0</span><span class="w">      </span><span class="c">#thermodynamic activity of B</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">r</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">k1</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">aA</span><span class="w">   </span><span class="c">#Turnover Frequency, 1/s</span>

<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">NS</span><span class="w">    </span><span class="c">#dNA/dt</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">r</span><span class="o">*</span><span class="n">NS</span><span class="w">    </span><span class="c">#dNB/dt</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>odebatch1! (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
</section>
<section id="writing-a-script-to-solve-the-ode-system-and-process-the-solution">
<h3>Writing a script to solve the ODE system and process the solution<a class="headerlink" href="#writing-a-script-to-solve-the-ode-system-and-process-the-solution" title="Link to this heading">#</a></h3>
<p>The cell below includes the code that solves the system of ODEs. Note that here we wrap the ODE solution in a function with various returns, which generally improves performance as the function only need be compiled once and can be solved subsequently for any parameter set by passing that parameter set to the solution function.</p>
<p>In general, ODE solvers in Julia use a logical construction that is similar to ODE solvers in most high level programming languages (e.g., Matlab, Octave, Python). It relies on the use of the <code class="docutils literal notranslate"><span class="pre">ODEProblem</span></code> constructor, which builds the problem (<code class="docutils literal notranslate"><span class="pre">prob</span></code>) that is passed to the solver.  Into this constructor, one provides the name of the function containing the ODEs (<code class="docutils literal notranslate"><span class="pre">odebatch1!</span></code>), the initial values of the state variables (<code class="docutils literal notranslate"><span class="pre">u0</span></code>), the integration span for the independent variable (<code class="docutils literal notranslate"><span class="pre">tspan</span></code>), and any additiona parameters to be passed to the ODEsystem (<code class="docutils literal notranslate"><span class="pre">par</span></code>).</p>
<p>Once the problem is created, a call to <code class="docutils literal notranslate"><span class="pre">solve(prob)</span></code> will solve the ODE system.  As with most ODE solvers, one has options.  Here, we are specifying the use of a Rosenbrock method (<code class="docutils literal notranslate"><span class="pre">Rosenbrock23</span></code>).  We are also including limits on the domain for all state variables through the use of a function that specifies the permissible domain of our state variables.  In this example, since our state variables are all physical quantities (mole numbers), I am specifying that all state variables must be positive at all times.  This is done by creating a domain function (<code class="docutils literal notranslate"><span class="pre">domainfunc</span></code>) that evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code> if any state variable becomes negative during the course of integration.  If that happens, the solver will return to the last step prior to encountering negative values, take a smaller step, and reevaluate.  This adds some cost to the evaluation as it will generally require taking progressively smaller steps until all state variables fall within the specified domain, but it is beneficial in cases like this one where there is a <em>physical</em> restriction on state variables (all molar quantities must be positive), but there is no <em>mathematical</em> restriction on their values becoming negative in the course of a numerical integration scheme.  The domainfunction is passed to the ODE solution through the use of the <code class="docutils literal notranslate"><span class="pre">isoutofdomain</span></code> keyword argument.</p>
<p>Once the solution is obtained, Julia permits interpolation of the solution at values inside of the integration span. Below, we use this to generate a simulated set of experimental data by evaluating values of <span class="math notranslate nohighlight">\(N_A\)</span> and <span class="math notranslate nohighlight">\(N_B\)</span> at 15 data points at specified time values. As is generally the case with most advanced numerical ODE solvers, we donâ€™t have control over the exact time steps taken by the solver; however, we are able to specify (by interpolation) the values of the solution at those time steps once the problem is solved.  This is accomplished below by passing the set of target times (<code class="docutils literal notranslate"><span class="pre">tvals</span></code>) to the raw solution structure returned by <code class="docutils literal notranslate"><span class="pre">solve(prob)</span></code>, i.e., <code class="docutils literal notranslate"><span class="pre">batchsol</span></code>.</p>
<p>Once molar quantities for A and B are obtained at desired times by interpolation, these values are used in calculating mole fractions, partial pressures, thermodynamic activities, and reaction rates at each time in <code class="docutils literal notranslate"><span class="pre">tvals</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">mainbatch1</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@unpack</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">,</span><span class="w"> </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">par</span>
<span class="w">    </span><span class="n">rseed</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="kt">Int64</span><span class="o">.</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
<span class="w">    </span><span class="n">domainfunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">any</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="c">#ensure all state variables are greater than 0</span>
<span class="w">    </span><span class="n">u0</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span><span class="n">NB0</span><span class="p">]</span><span class="w">       </span><span class="c">#initial state of NA and NB, moles</span>
<span class="w">    </span><span class="n">tspan</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">tvals</span><span class="p">[</span><span class="k">end</span><span class="p">])</span><span class="w">  </span><span class="c">#integration time span, seconds</span>
<span class="w">    </span><span class="n">prob</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">ODEProblem</span><span class="p">(</span><span class="n">odebatch1!</span><span class="p">,</span><span class="w"> </span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">tspan</span><span class="p">,</span><span class="w"> </span><span class="n">par</span><span class="p">)</span><span class="w"> </span><span class="c">#construct ODE Problem</span>
<span class="w">    </span><span class="n">batchsol</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="w"> </span><span class="n">Rosenbrock23</span><span class="p">(),</span><span class="w"> </span><span class="n">isoutofdomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">domainfunc</span><span class="p">)</span><span class="w"> </span><span class="c">#Solve ODE Problem</span>
<span class="w">    </span><span class="n">tsol</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">batchsol</span><span class="o">.</span><span class="n">t</span><span class="w">    </span><span class="c">#time values used by solver</span>
<span class="w">    </span><span class="n">NAsol</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">batchsol</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w"> </span><span class="c">#NA at each time value</span>
<span class="w">    </span><span class="n">NBsol</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">batchsol</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w"> </span><span class="c">#NB at each time value</span>
<span class="w">    </span><span class="n">yAsol</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">NAsol</span><span class="o">./</span><span class="mi">10</span><span class="w"> </span><span class="c">#Mole fraction of A at each time value used by solver</span>
<span class="w">    </span><span class="n">yBsol</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">NBsol</span><span class="o">./</span><span class="mi">10</span><span class="w"> </span><span class="c">#Mole fraction of B at each time value used by solver</span>
<span class="w">    </span><span class="n">CAsol</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">yAsol</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="w"> </span><span class="c">#CA at each time value used by solver, mol/L</span>
<span class="w">    </span><span class="n">CBsol</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">yBsol</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="w"> </span><span class="c">#CB at each time value used by solver, mol/L</span>
<span class="w">    </span>
<span class="w">    </span><span class="c">#display(@benchmark solve($prob, Rosenbrock23(), isoutofdomain = $domainfunc, saveat = $tvals))</span>
<span class="w">    </span><span class="c"># Create Noisy Data  </span>
<span class="w">    </span><span class="n">batchout</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">batchsol</span><span class="p">(</span><span class="n">tvals</span><span class="p">)</span><span class="w"> </span><span class="c">#interpolate solution at specific time values</span>
<span class="w">    </span><span class="n">NA</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">batchout</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w">   </span><span class="c">#NA at interpolation times, moles</span>
<span class="w">    </span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="n">rseed</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="n">NA</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">.*</span><span class="n">rand</span><span class="p">(</span><span class="n">Normal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">NA</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]))</span>
<span class="w">    </span><span class="n">NB</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">batchout</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w">   </span><span class="c">#NB at interpolation times, moles</span>
<span class="w">    </span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="n">rseed</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="w">    </span><span class="n">NB</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NB</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">.*</span><span class="n">rand</span><span class="p">(</span><span class="n">Normal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">NB</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]))</span>
<span class="w">    </span><span class="n">yA</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="o">./</span><span class="mi">10</span><span class="w"> </span><span class="c">#mole fraction of A at interpolation times</span>
<span class="w">    </span><span class="n">yB</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">NB</span><span class="o">./</span><span class="mi">10</span><span class="w"> </span><span class="c">#mole fraction of B at interpolation times</span>
<span class="w">    </span><span class="n">pA</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="w"> </span><span class="c">#partial pressure of A at interpolation times</span>
<span class="w">    </span><span class="n">pB</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">yB</span><span class="o">*</span><span class="n">P</span><span class="w"> </span><span class="c">#partial pressure of B at interpolation times</span>
<span class="w">    </span><span class="n">aA</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">pA</span><span class="o">/</span><span class="n">P0</span><span class="w"> </span><span class="c">#thermodynamic activity of A at interpolation times</span>
<span class="w">    </span><span class="n">aB</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">pB</span><span class="o">/</span><span class="n">P0</span><span class="w"> </span><span class="c">#thermodynamic activity of B at interpolation times</span>
<span class="w">    </span><span class="n">CA</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">pA</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="w"> </span><span class="c">#concentration of A at interpolation times</span>
<span class="w">    </span><span class="n">CB</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">pB</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="w"> </span><span class="c">#concentration of B at interpolation times</span>
<span class="w">    </span><span class="n">XA</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NA0</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">NA</span><span class="p">)</span><span class="o">/</span><span class="n">NA0</span><span class="w"> </span><span class="c">#Fractional Conversion at interpolation times</span>
<span class="w">    </span><span class="n">r</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">k1</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">aA</span><span class="w"> </span><span class="c">#rate of reaction at interpolation times.</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">NA</span><span class="p">,</span><span class="w"> </span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="n">CA</span><span class="p">,</span><span class="w"> </span><span class="n">CB</span><span class="p">,</span><span class="w"> </span><span class="n">aA</span><span class="p">,</span><span class="w"> </span><span class="n">aB</span><span class="p">,</span><span class="w"> </span><span class="n">XA</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tsol</span><span class="p">,</span><span class="w"> </span><span class="n">NAsol</span><span class="p">,</span><span class="w"> </span><span class="n">NBsol</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mainbatch1 (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
</section>
<section id="solving-the-ode-problem-and-storing-the-output">
<h3>Solving the ODE problem and storing the output<a class="headerlink" href="#solving-the-ode-problem-and-storing-the-output" title="Link to this heading">#</a></h3>
<p>The cell below solves the batch reactor model for the first Catalyst at a given parameter set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#Solve the problem, store the returns.</span>
<span class="n">A1</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">8.75e13</span><span class="o">/</span><span class="mi">1000</span><span class="w"> </span><span class="c">#Pre-exponential factor, 1/s</span>
<span class="n">EA1</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">90.4</span><span class="o">*</span><span class="mi">1000</span><span class="w"> </span><span class="c">#Barrier, J/mol</span>
<span class="n">tset</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">,</span><span class="w"> </span><span class="mi">900</span><span class="p">,</span><span class="w"> </span><span class="mi">1200</span><span class="p">,</span><span class="w"> </span><span class="mi">1500</span><span class="p">,</span><span class="w"> </span><span class="mi">1800</span><span class="p">,</span><span class="w"> </span><span class="mi">2100</span><span class="p">,</span><span class="w"> </span><span class="mi">2500</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="mi">3500</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w"> </span><span class="mi">4500</span><span class="p">,</span><span class="w"> </span><span class="mi">5300</span><span class="p">,</span><span class="w"> </span><span class="mi">6000</span><span class="p">,</span><span class="w"> </span><span class="mi">7000</span><span class="p">,</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span><span class="w"> </span><span class="mi">9000</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">]</span><span class="w"> </span><span class="c">#s</span>
<span class="n">k1</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">A1</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">EA1</span><span class="o">/</span><span class="n">R1</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="c">#rate constant, 1/s</span>
<span class="n">nlevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.03</span>
<span class="c"># par0   = [T0, P, P0, R, NA0, NB0, NS0, nlevel, tset, [2, 3]]; #initialize parameter set</span>

<span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">ComponentArray</span><span class="p">(</span>
<span class="w">    </span><span class="n">T</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span>
<span class="w">    </span><span class="n">P</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">,</span>
<span class="w">    </span><span class="n">P0</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span>
<span class="w">    </span><span class="n">R</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">,</span>
<span class="w">    </span><span class="n">NA0</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span>
<span class="w">    </span><span class="n">NB0</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span>
<span class="w">    </span><span class="n">NS0</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span>
<span class="w">    </span><span class="n">noise</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">nlevel</span><span class="p">,</span>
<span class="w">    </span><span class="n">tvals</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">tset</span><span class="p">,</span>
<span class="w">    </span><span class="n">rseed</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">NA1</span><span class="p">,</span><span class="w"> </span><span class="n">NB1</span><span class="p">,</span><span class="w"> </span><span class="n">CA1</span><span class="p">,</span><span class="w"> </span><span class="n">CB1</span><span class="p">,</span><span class="w"> </span><span class="n">aA1</span><span class="p">,</span><span class="w"> </span><span class="n">aB1</span><span class="p">,</span><span class="w"> </span><span class="n">XA1</span><span class="p">,</span><span class="w"> </span><span class="n">r1</span><span class="p">,</span><span class="w"> </span><span class="n">tsol</span><span class="p">,</span><span class="w"> </span><span class="n">NAsol</span><span class="p">,</span><span class="w"> </span><span class="n">NBsol</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">mainbatch1</span><span class="p">(</span><span class="n">par0</span><span class="p">);</span><span class="w"> </span><span class="c">#run batch simulation, workup data</span>
<span class="n">BATCH1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;time (s)&quot;</span><span class="w"> </span><span class="s">&quot;NA (moles)&quot;</span><span class="w"> </span><span class="s">&quot;NB (moles)&quot;</span><span class="w"> </span><span class="s">&quot;CA (mol/L)&quot;</span><span class="w"> </span><span class="s">&quot;CB (mol/L)&quot;</span><span class="w"> </span><span class="s">&quot;aA&quot;</span><span class="w"> </span><span class="s">&quot;aB&quot;</span><span class="w"> </span><span class="s">&quot;XA&quot;</span><span class="w"> </span><span class="s">&quot;r (1/s)&quot;</span><span class="p">]</span>
<span class="n">BATCH1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vcat</span><span class="p">(</span><span class="n">BATCH1</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">t1</span><span class="w"> </span><span class="n">NA1</span><span class="w"> </span><span class="n">NB1</span><span class="w"> </span><span class="n">CA1</span><span class="w"> </span><span class="n">CB1</span><span class="w"> </span><span class="n">aA1</span><span class="w"> </span><span class="n">aB1</span><span class="w"> </span><span class="n">XA1</span><span class="w"> </span><span class="n">r1</span><span class="p">])</span>

<span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;BATCH1.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">writedlm</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">BATCH1</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="p">)</span>
<span class="n">close</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>

<span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;BR02A.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">writedlm</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">BATCH1</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="p">)</span>
<span class="n">close</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Generate Data for comparing catalysts 1 to 5 (same catalyst, different dispersions/metal loadings)</span>

<span class="n">Ï</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-3</span><span class="w"> </span>
<span class="n">Nset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">*</span><span class="n">Ï</span>
<span class="n">noiseset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0.0005</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00125</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0025</span><span class="p">,</span><span class="w"> </span><span class="mf">0.02</span><span class="p">,</span><span class="w"> </span><span class="mf">0.04</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span>
<span class="n">seeds</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">12</span><span class="p">]</span>
<span class="n">tVOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">Ï</span><span class="p">))</span>
<span class="n">CVOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">Ï</span><span class="p">))</span>
<span class="n">XVOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">Ï</span><span class="p">))</span>
<span class="n">NVOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">Ï</span><span class="p">))</span>
<span class="w">    </span>
<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">Ï</span><span class="p">)</span>
<span class="w">    </span><span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">ComponentArray</span><span class="p">(</span>
<span class="w">        </span><span class="n">T</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span>
<span class="w">        </span><span class="n">P</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">R</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NA0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NB0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span>
<span class="w">        </span><span class="n">NS0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<span class="w">        </span><span class="n">noise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">noiseset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<span class="w">        </span><span class="n">tvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tset</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seeds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">NA</span><span class="p">,</span><span class="w"> </span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="n">CA</span><span class="p">,</span><span class="w"> </span><span class="n">CB</span><span class="p">,</span><span class="w"> </span><span class="n">aA</span><span class="p">,</span><span class="w"> </span><span class="n">aB</span><span class="p">,</span><span class="w"> </span><span class="n">XA</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mainbatch1</span><span class="p">(</span><span class="n">par0</span><span class="p">);</span><span class="w"> </span><span class="c">#run batch simulation, workup data</span>
<span class="w">    </span><span class="n">tVOL</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span>
<span class="w">    </span><span class="n">CVOL</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CA</span>
<span class="w">    </span><span class="n">XVOL</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XA</span>
<span class="w">    </span><span class="n">NVOL</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span>
<span class="k">end</span>

<span class="n">BATCH2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hcat</span><span class="p">(</span><span class="n">tVOL</span><span class="p">,</span><span class="w"> </span><span class="n">CVOL</span><span class="p">,</span><span class="w"> </span><span class="n">XVOL</span><span class="p">,</span><span class="w"> </span><span class="n">NVOL</span><span class="p">)</span>
<span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;BATCH2.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">writedlm</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">BATCH2</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="p">)</span>
<span class="n">close</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#Generate Data for all 5 cases at 4 different temperatures</span>
<span class="n">Tset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="mi">425</span><span class="p">,</span><span class="w"> </span><span class="mi">450</span><span class="p">,</span><span class="w"> </span><span class="mi">475</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">525</span><span class="p">]</span>
<span class="n">noiseset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">0.0005</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00125</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0025</span><span class="p">,</span><span class="w"> </span><span class="mf">0.02</span><span class="p">,</span><span class="w"> </span><span class="mf">0.04</span><span class="p">]</span>
<span class="n">BATCHT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Dict</span><span class="p">()</span>

<span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">Tset</span><span class="p">)</span>
<span class="w">    </span><span class="n">tVOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">Ï</span><span class="p">))</span>
<span class="w">    </span><span class="n">CVOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">Ï</span><span class="p">))</span>
<span class="w">    </span><span class="n">XVOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">Ï</span><span class="p">))</span>
<span class="w">    </span><span class="n">NVOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">Ï</span><span class="p">))</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">Ï</span><span class="p">)</span>
<span class="w">        </span><span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">ComponentArray</span><span class="p">(</span>
<span class="w">            </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tset</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="w">  </span>
<span class="w">            </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">R</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">NA0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">NB0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">NS0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<span class="w">            </span><span class="n">noise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">noiseset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<span class="w">            </span><span class="n">tvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tset</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seeds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="p">]</span><span class="o">*</span><span class="n">i</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">NA</span><span class="p">,</span><span class="w"> </span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="n">CA</span><span class="p">,</span><span class="w"> </span><span class="n">CB</span><span class="p">,</span><span class="w"> </span><span class="n">aA</span><span class="p">,</span><span class="w"> </span><span class="n">aB</span><span class="p">,</span><span class="w"> </span><span class="n">XA</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mainbatch1</span><span class="p">(</span><span class="n">par0</span><span class="p">);</span><span class="w"> </span><span class="c">#run batch simulation, workup data</span>
<span class="w">        </span><span class="n">tVOL</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span>
<span class="w">        </span><span class="n">CVOL</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CA</span>
<span class="w">        </span><span class="n">XVOL</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XA</span>
<span class="w">        </span><span class="n">NVOL</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">BATCHT</span><span class="p">[</span><span class="n">string</span><span class="p">(</span><span class="n">Tset</span><span class="p">[</span><span class="n">k</span><span class="p">])]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hcat</span><span class="p">(</span><span class="n">tVOL</span><span class="p">,</span><span class="w"> </span><span class="n">CVOL</span><span class="p">,</span><span class="w"> </span><span class="n">XVOL</span><span class="p">,</span><span class="w"> </span><span class="n">NVOL</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">save_object</span><span class="p">(</span><span class="s">&quot;BATCHT&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BATCHT</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="system-2-catalyst-2-with-deactivation">
<h2>System 2: Catalyst 2 with deactivation<a class="headerlink" href="#system-2-catalyst-2-with-deactivation" title="Link to this heading">#</a></h2>
<p>For this case, the catalyst is <em><strong>not</strong></em> stable. It undergoes some deactivation over the course of the reaction. We describe this deactivation by allowing the number of active sites, <span class="math notranslate nohighlight">\(N_S\)</span> to decrease from its starting value, <span class="math notranslate nohighlight">\(N_{S0}\)</span> over the course of reaction. This example differs from Case 1 in that the number of active sites is now time dependent, giving:</p>
<div class="math notranslate nohighlight">
\[\frac{dN_j}{dt} = \nu_j r'''N_S(t)\]</div>
<p><span class="math notranslate nohighlight">\(N_A\)</span> and <span class="math notranslate nohighlight">\(N_B\)</span> are time dependent, so we write balances in both species as usual.</p>
<div class="amsmath math notranslate nohighlight" id="equation-ab060041-ec4b-4fa9-acac-b3dc853a41de">
<span class="eqno">()<a class="headerlink" href="#equation-ab060041-ec4b-4fa9-acac-b3dc853a41de" title="Permalink to this equation">#</a></span>\[\begin{align}
    \frac{dN_A}{dt} &amp;= -r'''N_S(t) \\
    \frac{dN_B}{dt} &amp;= r'''N_S(t)
\end{align}\]</div>
<p>Where the rate of reaction for Catalyst 2 is given in turnover frequency units by:</p>
<div class="math notranslate nohighlight">
\[r^{\prime\prime\prime} = k_2a_A\]</div>
<p>In addition, we need a model that describes how the number of active sites is changing as a function of time.  Here, weâ€™ll assume first order deactivation; as such, the time derivative of the number of active sites, <span class="math notranslate nohighlight">\(N_S\)</span> is proportional to the number of active sites:</p>
<div class="math notranslate nohighlight">
\[ \frac{dN_S}{dt} = -k_d N_S\]</div>
<p>Subject to the initial condition that, at time = 0, the number of active sites is <span class="math notranslate nohighlight">\(N_{S0}\)</span>.  Here, the rate constant has units of inverse seconds, typical of a first order process.</p>
<p>In this example, the balances for <span class="math notranslate nohighlight">\(N_A\)</span> and <span class="math notranslate nohighlight">\(N_S\)</span> are coupled. In the case of first order deactivation, an analytical solution is tractable, but the more general approach is a numerical solution. We proceed with the numerical solution since it is extensible to a much larger class of reactor modelling problems. For this case, we have the following parameters available:</p>
<section id="id1">
<h3>Available Data<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="amsmath math notranslate nohighlight" id="equation-38630bc0-d8de-40f3-ae40-b134bfb2c015">
<span class="eqno">()<a class="headerlink" href="#equation-38630bc0-d8de-40f3-ae40-b134bfb2c015" title="Permalink to this equation">#</a></span>\[\begin{align}
    T       &amp;= 450.0 \ \mathrm{K} \\
    P       &amp;= 1 \ \mathrm{bar} \\ 
    P^\circ &amp;= 1 \ \mathrm{bar} \\ 
    N_{A0}  &amp;= 10 \ \mathrm{moles \ of \ A}\\
    N_{B0}  &amp;= 0 \ \mathrm{moles \ of \ B} \\
    N_{S0}  &amp;= 1.0 \times 10^{-3} \ \mathrm{moles \ of \ Active \ sites} \\
    A_{2}   &amp;= 2.5 \times 10^{11} \ \mathrm{s^{-1}} \\
    E_{A2}  &amp;= 88.4 \ \mathrm{kJ \ mol^{-1}} \\
    A_{d}   &amp;= 1.9 \times 10^{10} \ \mathrm{s^{-1}} \\
    E_{Ad}  &amp;= 115 \ \mathrm{kJ \ mol^{-1}} \\
\end{align}\]</div>
<p>For these problems, we additionally multiply all simulated data by noise selected randomly from a gaussian distribution with a mean of 1 and a standard deviation of 0.01.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">odebatch2!</span><span class="p">(</span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@unpack</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">,</span><span class="w"> </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">NA</span><span class="p">,</span><span class="w"> </span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="c"># State variables, moles   </span>
<span class="w">    </span><span class="n">NT</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NB</span><span class="w"> </span><span class="c">#total moles in bulk = A + B</span>
<span class="w">         </span>
<span class="w">    </span><span class="n">yA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="o">/</span><span class="n">NT</span><span class="w"> </span><span class="c">#mole fraction of A</span>
<span class="w">    </span><span class="n">yB</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NB</span><span class="o">/</span><span class="n">NT</span><span class="w"> </span><span class="c">#mole fraction of B</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">pA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="w">  </span><span class="c">#partial pressure of A, bar</span>
<span class="w">    </span><span class="n">pB</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">yB</span><span class="o">*</span><span class="n">P</span><span class="w">  </span><span class="c">#partial pressure of B, bar</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">aA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">pA</span><span class="o">/</span><span class="n">P0</span><span class="w"> </span><span class="c">#thermodynamic activity of A</span>
<span class="w">    </span><span class="n">aB</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">pB</span><span class="o">/</span><span class="n">P0</span><span class="w"> </span><span class="c">#thermodynamic activity of B</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">r</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">k2</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">aA</span><span class="w">            </span><span class="c">#rate of reaction, TOF units, 1/s</span>
<span class="w">    </span><span class="n">rd</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">kd</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">NS</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">NS0</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="c">#rate of active site loss, units of moles/time</span>
<span class="w">       </span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">NS</span><span class="w"> </span><span class="c">#dNA/dt</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">r</span><span class="o">*</span><span class="n">NS</span><span class="w"> </span><span class="c">#dNB/dt</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">rd</span><span class="w">   </span><span class="c">#dNS/dt</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">mainbatch2</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@unpack</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">,</span><span class="w"> </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">par</span>
<span class="w">    </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Int64</span><span class="o">.</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
<span class="w">    </span><span class="n">domainfunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">any</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="c">#keep state variables &gt; 0</span>
<span class="w">    </span><span class="n">u0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span><span class="n">NS0</span><span class="p">]</span><span class="w"> </span><span class="c">#initial state, moles</span>
<span class="w">    </span><span class="n">tspan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">tvals</span><span class="p">[</span><span class="k">end</span><span class="p">])</span><span class="w">  </span><span class="c">#integration time span</span>
<span class="w">    </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ODEProblem</span><span class="p">(</span><span class="n">odebatch2!</span><span class="p">,</span><span class="w"> </span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">tspan</span><span class="p">,</span><span class="w"> </span><span class="n">par</span><span class="p">)</span><span class="w"> </span><span class="c">#construct ODE problem</span>
<span class="w">    </span><span class="n">batchsol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="w"> </span><span class="n">Rosenbrock23</span><span class="p">(),</span><span class="w"> </span><span class="n">isoutofdomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">domainfunc</span><span class="p">)</span><span class="w"> </span><span class="c">#solve ODE problem</span>
<span class="w">    </span><span class="n">tsol</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">batchsol</span><span class="o">.</span><span class="n">t</span><span class="w"> </span><span class="c">#time steps taken by solver, seconds</span>
<span class="w">    </span><span class="n">NAsol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">batchsol</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w"> </span><span class="c">#NA at time steps taken by solver, moles</span>
<span class="w">    </span><span class="n">NBsol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">batchsol</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w"> </span><span class="c">#NB at time steps taken by solver, moles</span>
<span class="w">    </span><span class="n">yAsol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">NAsol</span><span class="o">./</span><span class="p">(</span><span class="n">NAsol</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NBsol</span><span class="p">)</span><span class="w"> </span><span class="c">#mole fraction of A at time steps in solver</span>
<span class="w">    </span><span class="n">yBsol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">NBsol</span><span class="o">./</span><span class="p">(</span><span class="n">NAsol</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NBsol</span><span class="p">)</span><span class="w"> </span><span class="c">#mole fraction of B at time steps in solver</span>
<span class="w">    </span><span class="n">CAsol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">yAsol</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="w">            </span><span class="c">#concentration of A at time steps in solver, mol/L</span>
<span class="w">    </span><span class="n">CBsol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">yBsol</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="w">            </span><span class="c">#concentration of B at time steps in solver, mol/L </span>

<span class="w">    </span><span class="n">batchout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batchsol</span><span class="p">(</span><span class="n">tvals</span><span class="p">)</span><span class="w">        </span><span class="c">#interpolate ODE solution at specific time points</span>
<span class="w">    </span><span class="n">NA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batchout</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w">                </span><span class="c">#NA at interpolation points, moles</span>
<span class="w">    </span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="n">rseed</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="n">NA</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">.*</span><span class="n">rand</span><span class="p">(</span><span class="n">Normal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">NA</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]))</span>
<span class="w">    </span><span class="n">NB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batchout</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w">                </span><span class="c">#NB at interpolation points, moles</span>
<span class="w">    </span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="n">rseed</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="w">    </span><span class="n">NB</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NB</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">.*</span><span class="n">rand</span><span class="p">(</span><span class="n">Normal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">NB</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]))</span>
<span class="w">    </span><span class="n">NS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batchout</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w">                </span><span class="c">#NS at interpolation points</span>
<span class="w">    </span><span class="n">yA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="o">./</span><span class="mi">10</span><span class="w">                       </span><span class="c">#mole fraction of A at interpolation points</span>
<span class="w">    </span><span class="n">yB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB</span><span class="o">./</span><span class="mi">10</span><span class="w">                       </span><span class="c">#mole fraction of B at interpolation points</span>
<span class="w">    </span><span class="n">pA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="w">                         </span><span class="c">#partial pressure of A at interpolation points, bar</span>
<span class="w">    </span><span class="n">pB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yB</span><span class="o">*</span><span class="n">P</span><span class="w">                         </span><span class="c">#partial pressure of B at interpolation points, bar </span>
<span class="w">    </span><span class="n">aA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pA</span><span class="o">/</span><span class="n">P0</span><span class="w">                        </span><span class="c">#thermodynamic activity of A</span>
<span class="w">    </span><span class="n">aB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pB</span><span class="o">/</span><span class="n">P0</span><span class="w">                        </span><span class="c">#thermodynamic activity of B</span>
<span class="w">    </span><span class="n">CA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pA</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="w">                       </span><span class="c">#CA at interpolation points, mol/L</span>
<span class="w">    </span><span class="n">CB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pB</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="w">                       </span><span class="c">#CB at interpolation points, mol/L</span>
<span class="w">    </span><span class="n">XA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NA0</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">NA</span><span class="p">)</span><span class="o">/</span><span class="n">NA0</span><span class="w">              </span><span class="c">#Conversion at interpolation points</span>
<span class="w">    </span><span class="n">r</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">k2</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">aA</span><span class="w">                     </span><span class="c">#reaction rate at interpolation points, 1/s</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">NA</span><span class="p">,</span><span class="w"> </span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="n">NS</span><span class="p">,</span><span class="w"> </span><span class="n">CA</span><span class="p">,</span><span class="w"> </span><span class="n">CB</span><span class="p">,</span><span class="w"> </span><span class="n">aA</span><span class="p">,</span><span class="w"> </span><span class="n">aB</span><span class="p">,</span><span class="w"> </span><span class="n">XA</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tsol</span><span class="p">,</span><span class="w"> </span><span class="n">NAsol</span><span class="p">,</span><span class="w"> </span><span class="n">NBsol</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mainbatch2 (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#Solve the problem, store the returns.</span>
<span class="n">A2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">2.5e14</span><span class="o">/</span><span class="mi">1000</span><span class="w"> </span><span class="c">#pre-exponential for reaction, 1/s</span>
<span class="n">EA2</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">88.4</span><span class="o">*</span><span class="mi">1000</span><span class="w">   </span><span class="c">#Barrier, J/mol</span>
<span class="n">Ad</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">1e13</span><span class="o">/</span><span class="mi">1000</span><span class="o">*</span><span class="mf">1.90</span><span class="w"> </span><span class="c">#pre-exponential for deactivation, 1/s</span>
<span class="n">EAd</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">115000</span><span class="w">      </span><span class="c">#Barrier for deactivation, J/mol</span>
<span class="n">tset</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">700</span><span class="p">,</span><span class="w"> </span><span class="mi">900</span><span class="p">,</span><span class="w"> </span><span class="mi">1200</span><span class="p">,</span><span class="w"> </span><span class="mi">1500</span><span class="p">,</span><span class="w"> </span><span class="mi">1800</span><span class="p">,</span><span class="w"> </span><span class="mi">2500</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="mi">3500</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w"> </span><span class="mi">4500</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="mi">6000</span><span class="p">,</span><span class="w"> </span><span class="mi">7000</span><span class="p">,</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span><span class="w"> </span><span class="mi">9000</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">]</span><span class="w"> </span><span class="c">#s</span>
<span class="n">k2</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">A2</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">EA2</span><span class="o">/</span><span class="n">R1</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="c">#rate constant for reaction, 1/s</span>
<span class="n">kd</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Ad</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">EAd</span><span class="o">/</span><span class="n">R1</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="c">#rate constant for deactivation, 1/s</span>
<span class="n">nlevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.03</span>
<span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">ComponentArray</span><span class="p">(</span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">R</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">NA0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">NB0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">NS0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">noise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nlevel</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">tvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tset</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">]</span>
<span class="w">    </span><span class="p">)</span>
<span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="n">NA2</span><span class="p">,</span><span class="w"> </span><span class="n">NB2</span><span class="p">,</span><span class="w"> </span><span class="n">NS2</span><span class="p">,</span><span class="w"> </span><span class="n">CA2</span><span class="p">,</span><span class="w"> </span><span class="n">CB2</span><span class="p">,</span><span class="w"> </span><span class="n">aA2</span><span class="p">,</span><span class="w"> </span><span class="n">aB2</span><span class="p">,</span><span class="w"> </span><span class="n">XA2</span><span class="p">,</span><span class="w"> </span><span class="n">r2</span><span class="p">,</span><span class="w"> </span><span class="n">tsol</span><span class="p">,</span><span class="w"> </span><span class="n">NAsol</span><span class="p">,</span><span class="w"> </span><span class="n">NBsol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mainbatch2</span><span class="p">(</span><span class="n">par0</span><span class="p">);</span><span class="w"> </span><span class="c">#solve model for case 2, workup data</span>
<span class="n">BR02B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;time (s)&quot;</span><span class="w"> </span><span class="s">&quot;NA (moles)&quot;</span><span class="w"> </span><span class="s">&quot;NB (moles)&quot;</span><span class="w"> </span><span class="s">&quot;CA (mol/L)&quot;</span><span class="w"> </span><span class="s">&quot;CB (mol/L)&quot;</span><span class="w"> </span><span class="s">&quot;aA&quot;</span><span class="w"> </span><span class="s">&quot;aB&quot;</span><span class="w"> </span><span class="s">&quot;XA&quot;</span><span class="w"> </span><span class="s">&quot;r (1/s)&quot;</span><span class="p">]</span>
<span class="n">BR02B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vcat</span><span class="p">(</span><span class="n">BR02B</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">t2</span><span class="w"> </span><span class="n">NA2</span><span class="w"> </span><span class="n">NB2</span><span class="w"> </span><span class="n">CA2</span><span class="w"> </span><span class="n">CB2</span><span class="w"> </span><span class="n">aA2</span><span class="w"> </span><span class="n">aB2</span><span class="w"> </span><span class="n">XA2</span><span class="w"> </span><span class="n">r2</span><span class="p">])</span>

<span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;BR02B.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">writedlm</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">BR02B</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="p">)</span>
<span class="n">close</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">k2</span><span class="p">(</span><span class="mi">450</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13.688774425900679
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">tset</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">))</span>
<span class="n">seeds</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">16</span><span class="w"> </span><span class="mi">17</span><span class="p">;</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="mi">19</span><span class="p">;</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">21</span><span class="p">;</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="mi">23</span><span class="p">;</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="mi">27</span><span class="p">;</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="mi">29</span><span class="p">;</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">31</span><span class="p">;</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="mi">33</span><span class="p">]</span>
<span class="n">Tset</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">collect</span><span class="p">(</span><span class="mi">400</span><span class="o">:</span><span class="mi">25</span><span class="o">:</span><span class="mi">600</span><span class="p">)</span>
<span class="n">k1out</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">Tset</span><span class="p">))</span>
<span class="n">k2out</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">Tset</span><span class="p">))</span>
<span class="n">XA3max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">Tset</span><span class="p">))</span>
<span class="n">XA4max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">Tset</span><span class="p">))</span>
<span class="n">CairoMakie</span><span class="o">.</span><span class="n">activate!</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;svg&quot;</span><span class="p">)</span>

<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">Tset</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">ComponentArray</span><span class="p">(</span>
<span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<span class="w">        </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">R</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NA0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NB0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NS0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">noise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nlevel</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">tvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tset</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seeds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="n">t3</span><span class="p">,</span><span class="w"> </span><span class="n">NA3</span><span class="p">,</span><span class="w"> </span><span class="n">NB3</span><span class="p">,</span><span class="w"> </span><span class="n">CA3</span><span class="p">,</span><span class="w"> </span><span class="n">CB3</span><span class="p">,</span><span class="w"> </span><span class="n">aA3</span><span class="p">,</span><span class="w"> </span><span class="n">aB3</span><span class="p">,</span><span class="w"> </span><span class="n">XA3</span><span class="p">,</span><span class="w"> </span><span class="n">r3</span><span class="p">,</span><span class="w"> </span><span class="n">tsol3</span><span class="p">,</span><span class="w"> </span><span class="n">NAsol3</span><span class="p">,</span><span class="w"> </span><span class="n">NBsol3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">mainbatch1</span><span class="p">(</span><span class="n">par0</span><span class="p">);</span>

<span class="w">    </span><span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">ComponentArray</span><span class="p">(</span>
<span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<span class="w">        </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">R</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NA0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NB0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NS0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">noise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nlevel</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">tvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tset</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seeds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="n">t4</span><span class="p">,</span><span class="w"> </span><span class="n">NA4</span><span class="p">,</span><span class="w"> </span><span class="n">NB4</span><span class="p">,</span><span class="w"> </span><span class="n">NS4</span><span class="p">,</span><span class="w"> </span><span class="n">CA4</span><span class="p">,</span><span class="w"> </span><span class="n">CB4</span><span class="p">,</span><span class="w"> </span><span class="n">aA4</span><span class="p">,</span><span class="w"> </span><span class="n">aB4</span><span class="p">,</span><span class="w"> </span><span class="n">XA4</span><span class="p">,</span><span class="w"> </span><span class="n">r4</span><span class="p">,</span><span class="w"> </span><span class="n">tsol4</span><span class="p">,</span><span class="w"> </span><span class="n">NAsol4</span><span class="p">,</span><span class="w"> </span><span class="n">NBsol4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mainbatch2</span><span class="p">(</span><span class="n">par0</span><span class="p">);</span>

<span class="w">    </span><span class="n">XAsol3</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NA0</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">NAsol3</span><span class="p">)</span><span class="o">/</span><span class="n">NA0</span>
<span class="w">    </span><span class="n">index3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="kt">Bool</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">tsol3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">    </span><span class="n">index3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">index3</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">XAsol3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.9</span><span class="w"> </span>
<span class="w">            </span><span class="n">index3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">index3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">X3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">tsol3</span><span class="p">[</span><span class="n">index3</span><span class="p">]</span>
<span class="w">    </span><span class="n">Y3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">log</span><span class="o">.</span><span class="p">(</span><span class="n">NAsol3</span><span class="p">[</span><span class="n">index3</span><span class="p">]</span><span class="o">/</span><span class="n">NA0</span><span class="p">)</span>
<span class="w">    </span><span class="n">m3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">X3</span><span class="p">)</span><span class="o">*</span><span class="n">X3</span><span class="o">\</span><span class="n">transpose</span><span class="p">(</span><span class="n">X3</span><span class="p">)</span><span class="o">*</span><span class="n">Y3</span>
<span class="w">    </span><span class="n">k13</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">m3</span><span class="o">*</span><span class="n">NT0</span><span class="o">/</span><span class="n">NS0</span><span class="o">*</span><span class="n">P0</span><span class="o">/</span><span class="n">P</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">XAsol4</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NA0</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">NAsol4</span><span class="p">)</span><span class="o">/</span><span class="n">NA0</span>
<span class="w">    </span><span class="n">index4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="kt">Bool</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">tsol4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">    </span><span class="n">index4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">index4</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">XAsol4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.7</span><span class="w"> </span>
<span class="w">            </span><span class="n">index4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">index4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">X4</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">tsol4</span><span class="p">[</span><span class="n">index4</span><span class="p">]</span>
<span class="w">    </span><span class="n">Y4</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">./</span><span class="p">(</span><span class="n">NAsol4</span><span class="p">[</span><span class="n">index4</span><span class="p">])</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">./</span><span class="n">NA0</span>
<span class="w">    </span><span class="n">m4</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">X4</span><span class="p">)</span><span class="o">*</span><span class="n">X4</span><span class="o">\</span><span class="n">transpose</span><span class="p">(</span><span class="n">X4</span><span class="p">)</span><span class="o">*</span><span class="n">Y4</span>
<span class="w">    </span><span class="n">k24</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m4</span><span class="o">*</span><span class="n">NT0</span><span class="o">^</span><span class="mi">2</span><span class="o">/</span><span class="n">NS0</span><span class="o">*</span><span class="n">P0</span><span class="o">^</span><span class="mi">2</span><span class="o">/</span><span class="n">P</span><span class="o">^</span><span class="mi">2</span>
<span class="w">     </span>
<span class="w">    </span><span class="n">k1out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k13</span>
<span class="w">    </span><span class="n">k2out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k24</span>
<span class="k">end</span>

<span class="n">f5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Polynomials</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1000</span><span class="w"> </span><span class="o">./</span><span class="n">Tset</span><span class="p">,</span><span class="w"> </span><span class="n">log</span><span class="o">.</span><span class="p">(</span><span class="n">k1out</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="n">f6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Polynomials</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1000</span><span class="w"> </span><span class="o">./</span><span class="n">Tset</span><span class="p">,</span><span class="w"> </span><span class="n">log</span><span class="o">.</span><span class="p">(</span><span class="n">k2out</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="n">A1out</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="p">(</span><span class="n">f5</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">EA1out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.314</span><span class="o">*</span><span class="n">f5</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">A2out</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="p">(</span><span class="n">f6</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">EA2out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.314</span><span class="o">*</span><span class="n">f6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="p">[</span><span class="n">A1out</span><span class="w"> </span><span class="n">EA1out</span><span class="w"> </span><span class="n">A2out</span><span class="w"> </span><span class="n">EA2out</span><span class="p">]</span>

<span class="n">kOUT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;T (K)&quot;</span><span class="w"> </span><span class="s">&quot;k1 (1/s)&quot;</span><span class="w"> </span><span class="s">&quot;k2 (1/s)&quot;</span><span class="p">]</span>
<span class="n">kOUT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vcat</span><span class="p">(</span><span class="n">kOUT</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">Tset</span><span class="w"> </span><span class="n">k1out</span><span class="w"> </span><span class="n">k2out</span><span class="p">])</span>
<span class="n">io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="s">&quot;BR02C.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">writedlm</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="w"> </span><span class="n">kOUT</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="p">)</span>
<span class="n">close</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#Solve the problem, store the returns.</span>
<span class="n">tset</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">,</span><span class="w"> </span><span class="mi">900</span><span class="p">,</span><span class="w"> </span><span class="mi">1200</span><span class="p">,</span><span class="w"> </span><span class="mi">1500</span><span class="p">,</span><span class="w"> </span><span class="mi">1800</span><span class="p">,</span><span class="w"> </span><span class="mi">2100</span><span class="p">,</span><span class="w"> </span><span class="mi">2500</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="mi">3500</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w"> </span><span class="mi">4500</span><span class="p">,</span><span class="w"> </span><span class="mi">5300</span><span class="p">,</span><span class="w"> </span><span class="mi">6000</span><span class="p">,</span><span class="w"> </span><span class="mi">7000</span><span class="p">,</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span><span class="w"> </span><span class="mi">9000</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">]</span><span class="w"> </span><span class="c">#s</span>
<span class="n">t3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">t3a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">NA3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">NB3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">CA3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">CB3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">aA3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">aB3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">XA3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">r3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">rseeds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">20</span><span class="w"> </span><span class="mi">21</span><span class="p">;</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="mi">23</span><span class="p">;</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="mi">27</span><span class="p">]</span>

<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span>
<span class="w">    </span><span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">ComponentArray</span><span class="p">(</span>
<span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">R</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NA0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NB0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NS0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">noise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">tvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tset</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rseeds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="p">]</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">NA</span><span class="p">,</span><span class="w"> </span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="n">CA</span><span class="p">,</span><span class="w"> </span><span class="n">CB</span><span class="p">,</span><span class="w"> </span><span class="n">aA</span><span class="p">,</span><span class="w"> </span><span class="n">aB</span><span class="p">,</span><span class="w"> </span><span class="n">XA</span><span class="p">,</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">tsol</span><span class="p">,</span><span class="w"> </span><span class="n">NAsol</span><span class="p">,</span><span class="w"> </span><span class="n">NBsol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mainbatch1</span><span class="p">(</span><span class="n">par0</span><span class="p">)</span><span class="w"> </span><span class="c">#run batch simulation, workup data</span>
<span class="w">    </span><span class="n">t3</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">tvals</span>
<span class="w">    </span><span class="n">t3a</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tvals</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">tset</span><span class="p">[</span><span class="k">end</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">NA3</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span>
<span class="w">    </span><span class="n">NB3</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB</span>
<span class="w">    </span><span class="n">CA3</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CA</span>
<span class="w">    </span><span class="n">CB3</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CB</span>
<span class="w">    </span><span class="n">aA3</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aA</span>
<span class="w">    </span><span class="n">aB3</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aB</span>
<span class="w">    </span><span class="n">XA3</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XA</span>
<span class="w">    </span><span class="n">r3</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">rate</span>
<span class="k">end</span>

<span class="n">BR02D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">t3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ta&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">t3a</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NA&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">NA3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CA&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CA3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aA&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">aA3</span><span class="p">)</span>
<span class="n">save_object</span><span class="p">(</span><span class="s">&quot;BR02D&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BR02D</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">odebatch3!</span><span class="p">(</span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@unpack</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span><span class="w"> </span><span class="n">NS0_l</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">,</span><span class="w"> </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">NA</span><span class="p">,</span><span class="w"> </span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="n">NS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="c"># State variables, moles   </span>
<span class="w">    </span><span class="n">NT</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NB</span><span class="w"> </span><span class="c">#total moles in bulk = A + B</span>
<span class="w">         </span>
<span class="w">    </span><span class="n">yA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="o">/</span><span class="n">NT</span><span class="w"> </span><span class="c">#mole fraction of A</span>
<span class="w">    </span><span class="n">yB</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NB</span><span class="o">/</span><span class="n">NT</span><span class="w"> </span><span class="c">#mole fraction of B</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">pA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="w">  </span><span class="c">#partial pressure of A, bar</span>
<span class="w">    </span><span class="n">pB</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">yB</span><span class="o">*</span><span class="n">P</span><span class="w">  </span><span class="c">#partial pressure of B, bar</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">aA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">pA</span><span class="o">/</span><span class="n">P0</span><span class="w"> </span><span class="c">#thermodynamic activity of A</span>
<span class="w">    </span><span class="n">aB</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">pB</span><span class="o">/</span><span class="n">P0</span><span class="w"> </span><span class="c">#thermodynamic activity of B</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">r</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">k2</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">aA</span><span class="w">            </span><span class="c">#rate of reaction, TOF units, 1/s</span>
<span class="w">    </span><span class="n">rd</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">kd</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">NS</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">NS0</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="c">#rate of active site loss, units of moles/time</span>
<span class="w">       </span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">NS</span><span class="w"> </span><span class="c">#dNA/dt</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">r</span><span class="o">*</span><span class="n">NS</span><span class="w"> </span><span class="c">#dNB/dt</span>
<span class="w">    </span><span class="n">du</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">rd</span><span class="w">   </span><span class="c">#dNS/dt</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">mainbatch3</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@unpack</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span><span class="w"> </span><span class="n">NS0_l</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">,</span><span class="w"> </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">par</span>
<span class="w">    </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Int64</span><span class="o">.</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
<span class="w">    </span><span class="n">domainfunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">any</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="c">#keep state variables &gt; 0</span>
<span class="w">    </span><span class="n">u0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span><span class="n">NS0_l</span><span class="p">]</span><span class="w"> </span><span class="c">#initial state, moles</span>
<span class="w">    </span><span class="n">tspan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">tvals</span><span class="p">[</span><span class="k">end</span><span class="p">])</span><span class="w">  </span><span class="c">#integration time span</span>
<span class="w">    </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ODEProblem</span><span class="p">(</span><span class="n">odebatch3!</span><span class="p">,</span><span class="w"> </span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">tspan</span><span class="p">,</span><span class="w"> </span><span class="n">par</span><span class="p">)</span><span class="w"> </span><span class="c">#construct ODE problem</span>
<span class="w">    </span><span class="n">batchsol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="w"> </span><span class="n">Rosenbrock23</span><span class="p">(),</span><span class="w"> </span><span class="n">isoutofdomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">domainfunc</span><span class="p">)</span><span class="w"> </span><span class="c">#solve ODE problem</span>

<span class="w">    </span><span class="c">#Generate Noisy Data</span>
<span class="w">    </span><span class="n">batchout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batchsol</span><span class="p">(</span><span class="n">tvals</span><span class="p">)</span><span class="w">        </span><span class="c">#interpolate ODE solution at specific time points</span>
<span class="w">    </span><span class="n">NA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batchout</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w">                </span><span class="c">#NA at interpolation points, moles</span>
<span class="w">    </span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="n">rseed</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="n">NA</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">.*</span><span class="n">rand</span><span class="p">(</span><span class="n">Normal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">NA</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]))</span>
<span class="w">    </span><span class="n">NB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batchout</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w">                </span><span class="c">#NB at interpolation points, moles</span>
<span class="w">    </span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="n">rseed</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="w">    </span><span class="n">NB</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NB</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]</span><span class="o">.*</span><span class="n">rand</span><span class="p">(</span><span class="n">Normal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">noise</span><span class="p">),</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">NB</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">]))</span><span class="w">    </span>
<span class="w">    </span><span class="n">NS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batchout</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w">                </span><span class="c">#NS at interpolation points</span>
<span class="w">    </span><span class="n">yA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span><span class="o">./</span><span class="mi">10</span><span class="w">                       </span><span class="c">#mole fraction of A at interpolation points</span>
<span class="w">    </span><span class="n">yB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB</span><span class="o">./</span><span class="mi">10</span><span class="w">                       </span><span class="c">#mole fraction of B at interpolation points</span>
<span class="w">    </span><span class="n">pA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yA</span><span class="o">*</span><span class="n">P</span><span class="w">                         </span><span class="c">#partial pressure of A at interpolation points, bar</span>
<span class="w">    </span><span class="n">pB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yB</span><span class="o">*</span><span class="n">P</span><span class="w">                         </span><span class="c">#partial pressure of B at interpolation points, bar </span>
<span class="w">    </span><span class="n">aA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pA</span><span class="o">/</span><span class="n">P0</span><span class="w">                        </span><span class="c">#thermodynamic activity of A</span>
<span class="w">    </span><span class="n">aB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pB</span><span class="o">/</span><span class="n">P0</span><span class="w">                        </span><span class="c">#thermodynamic activity of B</span>
<span class="w">    </span><span class="n">CA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pA</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="w">                       </span><span class="c">#CA at interpolation points, mol/L</span>
<span class="w">    </span><span class="n">CB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pB</span><span class="o">/</span><span class="n">R</span><span class="o">/</span><span class="n">T</span><span class="w">                       </span><span class="c">#CB at interpolation points, mol/L</span>
<span class="w">    </span><span class="n">XA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NA0</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">NA</span><span class="p">)</span><span class="o">/</span><span class="n">NA0</span><span class="w">              </span><span class="c">#Conversion at interpolation points</span>
<span class="w">    </span><span class="n">r</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">k2</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">aA</span><span class="w">                     </span><span class="c">#reaction rate at interpolation points, 1/s</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">NA</span><span class="p">,</span><span class="w"> </span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="n">NS</span><span class="p">,</span><span class="w"> </span><span class="n">CA</span><span class="p">,</span><span class="w"> </span><span class="n">CB</span><span class="p">,</span><span class="w"> </span><span class="n">aA</span><span class="p">,</span><span class="w"> </span><span class="n">aB</span><span class="p">,</span><span class="w"> </span><span class="n">XA</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">tsol</span><span class="p">,</span><span class="w"> </span><span class="n">NAsol</span><span class="p">,</span><span class="w"> </span><span class="n">NBsol</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mainbatch3 (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#Solve the problem, store the returns.</span>
<span class="n">A2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">2.5e14</span><span class="o">/</span><span class="mi">1000</span><span class="w"> </span><span class="c">#pre-exponential for reaction, 1/s</span>
<span class="n">EA2</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mf">88.4</span><span class="o">*</span><span class="mi">1000</span><span class="w">   </span><span class="c">#Barrier, J/mol</span>
<span class="n">Ad</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">1e13</span><span class="o">/</span><span class="mi">1000</span><span class="o">*</span><span class="mf">1.90</span><span class="w"> </span><span class="c">#pre-exponential for deactivation, 1/s</span>
<span class="n">EAd</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mi">115000</span><span class="w">      </span><span class="c">#Barrier for deactivation, J/mol</span>
<span class="n">tset</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">700</span><span class="p">,</span><span class="w"> </span><span class="mi">900</span><span class="p">,</span><span class="w"> </span><span class="mi">1200</span><span class="p">,</span><span class="w"> </span><span class="mi">1500</span><span class="p">,</span><span class="w"> </span><span class="mi">1800</span><span class="p">,</span><span class="w"> </span><span class="mi">2500</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="mi">3500</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w"> </span><span class="mi">4500</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="mi">6000</span><span class="p">,</span><span class="w"> </span><span class="mi">7000</span><span class="p">,</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span><span class="w"> </span><span class="mi">9000</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">]</span><span class="w"> </span><span class="c">#s</span>
<span class="n">k2</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">A2</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">EA2</span><span class="o">/</span><span class="n">R1</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="c">#rate constant for reaction, 1/s</span>
<span class="n">kd</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Ad</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">EAd</span><span class="o">/</span><span class="n">R1</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="c">#rate constant for deactivation, 1/s</span>

<span class="n">tset</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">,</span><span class="w"> </span><span class="mi">900</span><span class="p">,</span><span class="w"> </span><span class="mi">1200</span><span class="p">,</span><span class="w"> </span><span class="mi">1500</span><span class="p">,</span><span class="w"> </span><span class="mi">1800</span><span class="p">,</span><span class="w"> </span><span class="mi">2100</span><span class="p">,</span><span class="w"> </span><span class="mi">2500</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="mi">3500</span><span class="p">,</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w"> </span><span class="mi">4500</span><span class="p">,</span><span class="w"> </span><span class="mi">5300</span><span class="p">,</span><span class="w"> </span><span class="mi">6000</span><span class="p">,</span><span class="w"> </span><span class="mi">7000</span><span class="p">,</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span><span class="w"> </span><span class="mi">9000</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">]</span><span class="w"> </span><span class="c">#s</span>
<span class="n">tset</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">tset</span><span class="o">/</span><span class="mi">10</span>
<span class="n">sites</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NS0</span><span class="p">]</span>
<span class="n">rseeds</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">20</span><span class="w"> </span><span class="mi">21</span><span class="p">;</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="mi">23</span><span class="p">;</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="mi">27</span><span class="p">]</span>

<span class="n">sims</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>

<span class="n">t4</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">sims</span><span class="p">)</span>
<span class="n">t4a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">sims</span><span class="p">)</span>
<span class="n">NA4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">sims</span><span class="p">)</span>
<span class="n">NB4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">sims</span><span class="p">)</span>
<span class="n">NS4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">sims</span><span class="p">)</span>
<span class="n">CA4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">sims</span><span class="p">)</span>
<span class="n">CB4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">sims</span><span class="p">)</span>
<span class="n">aA4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">sims</span><span class="p">)</span>
<span class="n">aB4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">sims</span><span class="p">)</span>
<span class="n">XA4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">sims</span><span class="p">)</span>
<span class="n">r4</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tset</span><span class="p">),</span><span class="w"> </span><span class="n">sims</span><span class="p">)</span>

<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="n">sims</span>
<span class="w">    </span><span class="n">par0</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">ComponentArray</span><span class="p">(</span>
<span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">P0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">R</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NA0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NB0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NS0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NS0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">NS0_l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sites</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span>
<span class="w">        </span><span class="n">noise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">tvals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tset</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">rseed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="n">tvals</span><span class="p">,</span><span class="w"> </span><span class="n">NA</span><span class="p">,</span><span class="w"> </span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="n">NS</span><span class="p">,</span><span class="w"> </span><span class="n">CA</span><span class="p">,</span><span class="w"> </span><span class="n">CB</span><span class="p">,</span><span class="w"> </span><span class="n">aA</span><span class="p">,</span><span class="w"> </span><span class="n">aB</span><span class="p">,</span><span class="w"> </span><span class="n">XA</span><span class="p">,</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">tsol</span><span class="p">,</span><span class="w"> </span><span class="n">NAsol</span><span class="p">,</span><span class="w"> </span><span class="n">NBsol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mainbatch3</span><span class="p">(</span><span class="n">par0</span><span class="p">)</span><span class="w"> </span><span class="c">#run batch simulation, workup data</span>
<span class="w">    </span><span class="n">t4</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">tvals</span>
<span class="w">    </span><span class="n">t4a</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tvals</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">tset</span><span class="p">[</span><span class="k">end</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">NA4</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NA</span>
<span class="w">    </span><span class="n">NB4</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NB</span>
<span class="w">    </span><span class="n">NS4</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NS</span>
<span class="w">    </span><span class="n">CA4</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CA</span>
<span class="w">    </span><span class="n">CB4</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CB</span>
<span class="w">    </span><span class="n">aA4</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aA</span>
<span class="w">    </span><span class="n">aB4</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aB</span>
<span class="w">    </span><span class="n">XA4</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XA</span>
<span class="w">    </span><span class="n">r4</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">rate</span>
<span class="w">    </span><span class="n">tvals</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">tvals</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="n">tset</span><span class="p">[</span><span class="k">end</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">sites</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">vcat</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span><span class="w"> </span><span class="n">NS</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="k">end</span>

<span class="n">BR02E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Dict</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">t4</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ta&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">t4a</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NA&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">NA4</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CA&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CA4</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aA&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">aA4</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NS&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">NS4</span><span class="p">)</span>
<span class="n">save_object</span><span class="p">(</span><span class="s">&quot;BR02E&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BR02E</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.11"
        },
        kernelOptions: {
            name: "julia-1.11",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.11'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-reaction">The Reaction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-1-catalyst-1-with-no-deactivation">System 1: Catalyst 1 with no deactivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#available-data">Available Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-the-ode-system-that-describes-batch-reactor">Construct the ODE system that describes batch reactor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-a-script-to-solve-the-ode-system-and-process-the-solution">Writing a script to solve the ODE system and process the solution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-the-ode-problem-and-storing-the-output">Solving the ODE problem and storing the output</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-2-catalyst-2-with-deactivation">System 2: Catalyst 2 with deactivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Available Data</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jesse Q. Bond, Syracuse University
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>